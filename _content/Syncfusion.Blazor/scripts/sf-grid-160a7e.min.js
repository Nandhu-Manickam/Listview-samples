(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["sf-grid"],{

/***/ "./bundles/sf-grid.js":
/*!****************************!*\
  !*** ./bundles/sf-grid.js ***!
  \****************************/
/*! no exports provided */
/*! all exports used */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modules_sf_grid_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../modules/sf-grid.js */ "./modules/sf-grid.js");
/* harmony import */ var _modules_sf_grid_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_modules_sf_grid_js__WEBPACK_IMPORTED_MODULE_0__);


/***/ }),

/***/ "./modules/sf-grid.js":
/*!****************************!*\
  !*** ./modules/sf-grid.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

window.sfBlazor = window.sfBlazor || {};

window.sfBlazor.Grid = function () {
  'use strict';
  /**
   * The function used to update Dom using requestAnimationFrame.
   * @param  {Function} fn - Function that contains the actual action
   * @return {Promise<T>}
   * @hidden
   */

  function getUpdateUsingRaf(updateFunction, callBack) {
    requestAnimationFrame(function () {
      try {
        callBack(null, updateFunction());
      } catch (e) {
        callBack(e);
      }
    });
  }
  /** @hidden */


  var scrollWidth = null;
  /** @hidden */

  function getScrollBarWidth() {
    if (scrollWidth !== null) {
      return scrollWidth;
    }

    var divNode = document.createElement('div');
    var value = 0;
    divNode.style.cssText = 'width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;';
    document.body.appendChild(divNode);
    value = divNode.offsetWidth - divNode.clientWidth | 0;
    document.body.removeChild(divNode);
    return scrollWidth = value;
  }

  function getSiblingsHeight(element) {
    var previous = getHeightFromDirection(element, 'previous');
    var next = getHeightFromDirection(element, 'next');
    return previous + next;
  }

  function getHeightFromDirection(element, direction) {
    var sibling = element[direction + 'ElementSibling'];
    var result = 0;
    var classList$$1 = ['e-gridheader', 'e-gridfooter', 'e-groupdroparea', 'e-gridpager', 'e-toolbar'];

    while (sibling) {
      if (classList$$1.some(function (value) {
        return sibling.classList.contains(value);
      })) {
        result += sibling.offsetHeight;
      }

      sibling = sibling[direction + 'ElementSibling'];
    }

    return result;
  }
  /** @hidden */


  function parentsUntil(elem, selector, isID) {
    var parent = elem;

    while (parent) {
      if (isID ? parent.id === selector : parent.classList.contains(selector)) {
        break;
      }

      parent = parent.parentElement;
    }

    return parent;
  }
  /** @hidden */


  function getElementIndex(element, elements) {
    var index = -1;

    for (var i = 0, len = elements.length; i < len; i++) {
      if (elements[i].isEqualNode(element)) {
        index = i;
        break;
      }
    }

    return index;
  }
  /** @hidden */


  function inArray(value, collection) {
    for (var i = 0, len = collection.length; i < len; i++) {
      if (collection[i] === value) {
        return i;
      }
    }

    return -1;
  }

  function getPosition(e) {
    var position = {};
    position.x = sf.base.isNullOrUndefined(e.clientX) ? e.changedTouches[0].clientX : e.clientX;
    position.y = sf.base.isNullOrUndefined(e.clientY) ? e.changedTouches[0].clientY : e.clientY;
    return position;
  }
  /**
   * @hidden
   */


  function iterateArrayOrObject(collection, predicate) {
    var result = [];

    for (var i = 0, len = collection.length; i < len; i++) {
      var pred = predicate(collection[i], i);

      if (!sf.base.isNullOrUndefined(pred)) {
        result.push(pred);
      }
    }

    return result;
  }
  /** @hidden */


  function isActionPrevent(element) {
    var dlg = element.querySelector('#' + element.id + 'EditConfirm');
    return element.querySelectorAll('.e-updatedtd').length && (dlg ? dlg.classList.contains('e-popup-close') : true);
  }
  /**
   * @hidden
   */


  function isGroupAdaptive(grid) {
    return grid.options.enableVirtualization && grid.options.groupCount > 0 && (grid.options.offline || grid.options.url === '');
  }
  /** @hidden */


  var rowHeight;
  /** @hidden */

  function getRowHeight(element) {
    if (rowHeight !== undefined) {
      return rowHeight;
    }

    var table = sf.base.createElement('table', {
      className: 'e-table',
      styles: 'visibility: hidden'
    });
    table.innerHTML = '<tr><td class="e-rowcell">A<td></tr>';
    element.appendChild(table);
    var rect = table.querySelector('td').getBoundingClientRect();
    element.removeChild(table);
    rowHeight = Math.ceil(rect.height);
    return rowHeight;
  }
  /**
   * The `Scroll` module is used to handle scrolling behaviour.
   */


  var Scroll =
  /** @class */
  function () {
    /**
     * Constructor for the Grid scrolling.
     * @hidden
     */
    function Scroll(parent) {
      //To maintain scroll state on grid actions.
      this.previousValues = {
        top: 0,
        left: 0
      };
      this.oneTimeReady = true;
      this.parent = parent;
      this.addEventListener();
      this.setHeight();
      this.setPadding();
    }
    /**
     * @hidden
     */


    Scroll.prototype.setHeight = function () {
      var mHdrHeight = 0;
      var content = this.parent.element.querySelector('.e-content');

      if (this.parent.options.frozenRows && this.parent.options.height !== 'auto') {
        var tbody = this.parent.element.querySelector('.e-headercontent').querySelector('tbody');
        mHdrHeight = tbody ? tbody.offsetHeight : 0;
        content.style.height = sf.base.formatUnit(parseInt(this.parent.options.height) - mHdrHeight);
      }
    };
    /**
     * @hidden
     */


    Scroll.prototype.setPadding = function () {
      if (this.parent.options.height == "auto") {
        return;
      }

      var content = this.parent.element.querySelector('.e-gridheader');
      var scrollWidth = Scroll.getScrollBarWidth() - this.getThreshold();
      var cssProps = this.getCssProperties();
      content.style[cssProps.padding] = scrollWidth > 0 ? scrollWidth + 'px' : '0px';
      content.querySelector('.e-headercontent').style[cssProps.border] = scrollWidth > 0 ? '1px' : '0px';
      var footer = this.parent.element.querySelector('.e-gridfooter');

      if (footer) {
        var footerContent = footer.querySelector('.e-summarycontent');
        footerContent.style[cssProps.border] = scrollWidth > 0 ? '1px' : '0px';
        footer.style[cssProps.padding] = scrollWidth > 0 ? scrollWidth + 'px' : '0px';
      }
    };
    /**
     * @hidden
     */


    Scroll.prototype.removePadding = function (rtl) {
      var cssProps = this.getCssProperties(rtl);
      var hDiv = this.parent.getHeaderContent().querySelector('.e-headercontent');
      hDiv.style[cssProps.border] = '';
      hDiv.parentElement.style[cssProps.padding] = '';
      var footerDiv = this.parent.getFooterContent();
    };
    /**
     * Refresh makes the Grid adoptable with the height of parent container.
     *
     * > The [`height`](grid/#height/) must be set to 100%.
     * @return
     */


    Scroll.prototype.refresh = function () {
      if (this.parent.options.height !== '100%') {
        return;
      }

      var content = this.parent.element.querySelector(".e-gridcontent");
      var height = getSiblingsHeight(content);
      content.style.height = 'calc(100% - ' + height + 'px)'; //Set the height to the '.e-gridcontent';
    };

    Scroll.prototype.getThreshold = function () {
      /* Some browsers places the scroller outside the content,
       * hence the padding should be adjusted.*/
      var appName = sf.base.Browser.info.name;

      if (appName === 'mozilla') {
        return 0.5;
      }

      return 1;
    };
    /**
     * @hidden
     */


    Scroll.prototype.addEventListener = function () {
      this.wireEvents(); // this.parent.on(onEmpty, this.wireEvents, this);
      // this.parent.on(contentReady, this.wireEvents, this);
      // this.parent.on(uiUpdate, this.onPropertyChanged, this);
      // this.parent.on(textWrapRefresh, this.wireEvents, this);
      // this.parent.on(headerRefreshed, this.setScrollLeft, this);
    }; // private setScrollLeft(): void {
    //     if (this.parent.options.frozenColumns) {
    //         (<HTMLElement>(<SfGrid>this.parent).headerModule.getMovableHeader()).scrollLeft = this.previousValues.left;
    //     }
    // }


    Scroll.prototype.onContentScroll = function (scrollTarget) {
      var _this = this;

      var element = scrollTarget;
      var isHeader = element.classList.contains('e-headercontent');
      return function (e) {
        if (_this.content.querySelector('tbody') === null) {
          return;
        }

        var target = e.target;
        var left = target.scrollLeft;
        var sLimit = target.scrollWidth;
        var isFooter = target.classList.contains('e-summarycontent');

        if (_this.previousValues.left === left) {
          _this.previousValues.top = !isHeader ? _this.previousValues.top : target.scrollTop;
          return;
        }

        element.scrollLeft = left;
        var footer = _this.parent.options.frozenColumns != 0 ? _this.parent.element.querySelector('.e-movablefootercontent') : _this.parent.element.querySelector('.e-summarycontent');

        if (footer) {
          footer.scrollLeft = left;
        }

        if (isFooter) {
          _this.header.scrollLeft = left;
        }

        _this.previousValues.left = left;
      };
    };

    Scroll.prototype.onFreezeContentScroll = function (scrollTarget) {
      var _this = this;

      var element = scrollTarget;
      return function (e) {
        if (_this.content.querySelector('tbody') === null) {
          return;
        }

        var target = e.target;
        var top = target.scrollTop;

        if (_this.previousValues.top === top) {
          return;
        }

        element.scrollTop = top;
        _this.previousValues.top = top;
      };
    };

    Scroll.prototype.onWheelScroll = function (scrollTarget) {
      var _this = this;

      var element = scrollTarget;
      return function (e) {
        if (_this.content.querySelector('tbody') === null) {
          return;
        }

        var top = element.scrollTop + (e.deltaMode === 1 ? e.deltaY * 30 : e.deltaY);

        if (_this.previousValues.top === top) {
          return;
        }

        e.preventDefault();
        _this.parent.getContent().querySelector('.e-frozencontent').scrollTop = top;
        element.scrollTop = top;
        _this.previousValues.top = top;
      };
    };

    Scroll.prototype.onTouchScroll = function (scrollTarget) {
      var _this = this;

      var element = scrollTarget;
      return function (e) {
        if (e.pointerType === 'mouse') {
          return;
        }

        var cont;
        var mHdr;

        var pageXY = _this.getPointXY(e);

        var top = element.scrollTop + (_this.pageXY.y - pageXY.y);
        var left = element.scrollLeft + (_this.pageXY.x - pageXY.x);

        if (_this.parent.getHeaderContent().contains(e.target)) {
          mHdr = _this.parent.options.frozenColumns ? _this.parent.getHeaderContent().querySelector('.e-movableheader') : _this.parent.getHeaderContent().querySelector('.e-headercontent');

          if (_this.previousValues.left === left || left < 0 || mHdr.scrollWidth - mHdr.clientWidth < left) {
            return;
          }

          e.preventDefault();
          mHdr.scrollLeft = left;
          element.scrollLeft = left;
          _this.pageXY.x = pageXY.x;
          _this.previousValues.left = left;
        } else {
          cont = _this.parent.getContent().querySelector('.e-frozencontent');

          if (_this.previousValues.top === top && (top < 0 || cont.scrollHeight - cont.clientHeight < top) || top < 0 || cont.scrollHeight - cont.clientHeight < top) {
            return;
          }

          e.preventDefault();
          cont.scrollTop = top;
          element.scrollTop = top;
          _this.pageXY.y = pageXY.y;
          _this.previousValues.top = top;
        }
      };
    };

    Scroll.prototype.setPageXY = function () {
      var _this = this;

      return function (e) {
        if (e.pointerType === 'mouse') {
          return;
        }

        _this.pageXY = _this.getPointXY(e);
      };
    };

    Scroll.prototype.getPointXY = function (e) {
      var pageXY = {
        x: 0,
        y: 0
      };

      if (e.touches && e.touches.length) {
        pageXY.x = e.touches[0].pageX;
        pageXY.y = e.touches[0].pageY;
      } else {
        pageXY.x = e.pageX;
        pageXY.y = e.pageY;
      }

      return pageXY;
    };

    Scroll.prototype.wireEvents = function () {
      var _this = this;

      if (this.oneTimeReady) {
        var frzCols = this.parent.options.frozenColumns;
        this.content = this.parent.getContent();
        this.header = this.parent.getHeaderContent();
        var mCont = this.content.querySelector('.e-movablecontent');
        var fCont = this.content.querySelector('.e-frozencontent');
        var mHdr = this.header.querySelector('.e-movableheader');

        if (this.parent.options.frozenColumns) {
          sf.base.EventHandler.add(frzCols ? mHdr : this.header, 'touchstart pointerdown', this.setPageXY(), this);
          sf.base.EventHandler.add(frzCols ? mHdr : this.header, 'touchmove pointermove', this.onTouchScroll(frzCols ? mCont : this.content), this);
        }

        if (frzCols) {
          sf.base.EventHandler.add(mCont, 'scroll', this.onContentScroll(mHdr), this);
          sf.base.EventHandler.add(mCont, 'scroll', this.onFreezeContentScroll(fCont), this);
          sf.base.EventHandler.add(fCont, 'scroll', this.onFreezeContentScroll(mCont), this);
          sf.base.EventHandler.add(mHdr, 'scroll', this.onContentScroll(mCont), this);
          sf.base.EventHandler.add(fCont, 'wheel', this.onWheelScroll(mCont), this);
          sf.base.EventHandler.add(fCont, 'touchstart pointerdown', this.setPageXY(), this);
          sf.base.EventHandler.add(fCont, 'touchmove pointermove', this.onTouchScroll(mCont), this);
        } else {
          sf.base.EventHandler.add(this.content, 'scroll', this.onContentScroll(this.header), this);
          sf.base.EventHandler.add(this.header, 'scroll', this.onContentScroll(this.content), this);
        }

        if (this.parent.options.aggregatesCount) {
          var footer = this.parent.options.frozenColumns ? this.parent.element.querySelector('.e-movablefootercontent') : this.parent.element.querySelector('.e-summarycontent');
          sf.base.EventHandler.add(footer, 'scroll', this.onContentScroll(this.content), this);
        }

        this.refresh();
        this.oneTimeReady = false;
      }

      var table = this.parent.getContent().querySelector(".e-table");
      var sLeft;
      var sHeight;
      var clientHeight;
      getUpdateUsingRaf(function () {
        sLeft = _this.header.scrollLeft;
        sHeight = table.scrollHeight;
        clientHeight = _this.parent.getContent().clientHeight;
      }, function () {
        if (!_this.parent.options.enableVirtualization) {
          if (sHeight < clientHeight) {
            sf.base.addClass(table.querySelectorAll('tr:last-child td'), 'e-lastrowcell');

            if (_this.parent.options.frozenColumns) {
              sf.base.addClass(_this.parent.getContent().querySelector('.e-movablecontent').querySelectorAll('tr:last-child td'), 'e-lastrowcell');
            }
          }

          if ((_this.parent.options.frozenColumns > 0 || _this.parent.options.frozenColumns > 0) && _this.header.querySelector('.e-movableheader')) {
            _this.header.querySelector('.e-movableheader').scrollLeft = _this.previousValues.left;
          } else {
            _this.header.scrollLeft = _this.previousValues.left;
          }

          _this.content.scrollLeft = _this.previousValues.left;
          _this.content.scrollTop = _this.previousValues.top;
        }

        if (!_this.parent.options.enableColumnVirtualization) {
          _this.content.scrollLeft = sLeft;
        }

        if (_this.parent.options.frozenColumns && _this.header.querySelector('.e-movableheader')) {
          _this.header.querySelector('.e-movableheader').scrollLeft = _this.content.querySelector('.e-movablecontent').scrollLeft;
        }
      });
    };
    /**
     * @hidden
     */


    Scroll.prototype.getCssProperties = function (rtl) {
      var css = {};
      var enableRtl = sf.base.isNullOrUndefined(rtl) ? this.parent.options.enableRtl : rtl;
      css.border = enableRtl ? 'borderLeftWidth' : 'borderRightWidth';
      css.padding = enableRtl ? 'paddingLeft' : 'paddingRight';
      return css;
    };
    /**
     * @hidden
     */


    Scroll.prototype.destroy = function () {
      var gridElement = this.parent.element;

      if (!gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {
        return;
      } //Remove padding


      this.removePadding(); //Remove Dom event

      sf.base.EventHandler.remove(this.parent.getContent(), 'scroll', this.onContentScroll);
    };
    /**
     * Function to get the scrollbar width of the browser.
     * @return {number}
     * @hidden
     */


    Scroll.getScrollBarWidth = function () {
      return getScrollBarWidth();
    };

    return Scroll;
  }();
  /**
   * Frozen rows and column handling
   */


  var Freeze =
  /** @class */
  function () {
    function Freeze(parent) {
      this.parent = parent;
      this.frozenHeader = parent.element.querySelector('.e-frozenheader');
      this.movableHeader = parent.element.querySelector('.e-movableheader');
      this.addEventListener();
    }

    Freeze.prototype.addEventListener = function () {
      if (this.parent.options.frozenColumns || this.parent.options.frozenRows) {
        this.setFrozenHeight();
        this.refreshFreeze({
          case: 'textwrap'
        });
        this.refreshFreeze({
          case: 'refreshHeight'
        });
      }
    };

    Freeze.prototype.refreshFreeze = function (obj) {
      if (obj.case === 'textwrap' || obj.case === 'refreshHeight') {
        var fRows = void 0;
        var mRows = void 0;
        var fHdr = this.getFrozenHeader();
        var mHdr = this.getMovableHeader();
        var cont = this.parent.getContent();
        var wrapMode = this.parent.options.wrapMode;

        if (obj.case === 'textwrap') {
          if (wrapMode !== 'Header' || obj.isModeChg) {
            fRows = cont.querySelector('.e-frozencontent').querySelectorAll('tr');
            mRows = cont.querySelector('.e-movablecontent').querySelectorAll('tr');
            this.setWrapHeight(fRows, mRows, obj.isModeChg, true);
          }

          if (wrapMode === 'Both' || obj.isModeChg) {
            fRows = fHdr.querySelectorAll('tr');
            mRows = mHdr.querySelectorAll('tr');
          } else {
            fRows = fHdr.querySelector(wrapMode === 'Content' ? 'tbody' : 'thead').querySelectorAll('tr');
            mRows = mHdr.querySelector(wrapMode === 'Content' ? 'tbody' : 'thead').querySelectorAll('tr');
          }

          if (!this.parent.getHeaderContent().querySelectorAll('.e-stackedheadercell').length) {
            this.setWrapHeight(fRows, mRows, obj.isModeChg, false, false);
          }

          this.refreshStackedHdrHgt();
        } else if (obj.case === 'refreshHeight') {
          this.setWrapHeight(cont.querySelector('.e-frozencontent').querySelectorAll('tr'), cont.querySelector('.e-movablecontent').querySelectorAll('tr'), obj.isModeChg);

          if (!this.parent.getHeaderContent().querySelectorAll('.e-stackedheadercell').length) {
            this.setWrapHeight(fHdr.querySelectorAll('tr'), mHdr.querySelectorAll('tr'), obj.isModeChg);
          }
        }
      }
    };

    Freeze.prototype.updateResizeHandler = function () {
      var elements = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-rhandler'));

      for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = elements[i].parentElement.offsetHeight + 'px';
      }
    };

    Freeze.prototype.setWrapHeight = function (fRows, mRows, isModeChg, isContReset, isStackedHdr) {
      var fRowHgt;
      var mRowHgt;
      var isWrap = this.parent.options.allowTextWrap;
      var wrapMode = this.parent.options.wrapMode;
      var tHead = this.parent.getHeaderContent().querySelector('thead');
      var tBody = this.parent.getHeaderContent().querySelector('tbody');
      var height = [];
      var width = [];

      for (var i = 0, len = fRows.length; i < len; i++) {
        //separate loop for performance issue 
        if (!sf.base.isNullOrUndefined(fRows[i]) && !sf.base.isNullOrUndefined(mRows[i])) {
          height[i] = fRows[i].getBoundingClientRect().height; //https://pagebuildersandwich.com/increased-plugins-performance-200/

          width[i] = mRows[i].getBoundingClientRect().height;
        }
      }

      for (var i = 0, len = fRows.length; i < len; i++) {
        if (isModeChg && (wrapMode === 'Header' && isContReset || wrapMode === 'Content' && tHead.contains(fRows[i]) || wrapMode === 'Header' && tBody.contains(fRows[i])) || isStackedHdr) {
          fRows[i].style.height = null;
          mRows[i].style.height = null;
        }

        fRowHgt = height[i];
        mRowHgt = width[i];

        if (fRowHgt > mRowHgt) {
          mRows[i].style.height = fRowHgt + 'px';
        } else if (mRowHgt > fRowHgt) {
          fRows[i].style.height = mRowHgt + 'px';
        } //TODO: check below commented code is not working hence used above
        // if (!isNullOrUndefined(fRows[i]) && fRows[i].childElementCount && ((isWrap && fRowHgt < mRowHgt) ||
        //     (!isWrap && fRowHgt < mRowHgt))) {
        //     fRows[i].style.height = mRowHgt + 'px';
        // }
        // if (mRows && !isNullOrUndefined(mRows[i]) && mRows[i].childElementCount && ((isWrap && fRowHgt > mRowHgt) ||
        //     (!isWrap && fRowHgt > mRowHgt))) {
        //     mRows[i].style.height = fRowHgt + 'px';
        // }

      }

      if (isWrap) {
        this.setFrozenHeight();
      }
    };

    Freeze.prototype.setFrozenHeight = function (height) {
      if (height === void 0) {
        height = getScrollBarWidth();
      }

      var movableContentHeight = this.parent.element.querySelector('.e-movablecontent').getBoundingClientRect().height;
      var movableContent = this.parent.element.querySelector('.e-movablecontent');
      var frozenContent = this.parent.element.querySelector('.e-frozencontent'); //if (movableContent.scrollWidth - movableContent.clientWidth) {
      //TODO: why we need commented code?

      frozenContent.style.height = movableContentHeight - height + 'px';
      frozenContent.style.borderBottom = ''; // } else {
      //     frozenContent.style.height = movableContentHeight + 'px';
      //     if ((frozenContent.scrollHeight <= frozenContent.clientHeight) ||
      //         (movableContent.scrollHeight <= movableContent.clientHeight)) {
      //         this.parent.scrollModule.removePadding();
      //     }
      //     frozenContent.style.borderBottom = '0px';
      // }
    };

    Freeze.prototype.refreshStackedHdrHgt = function () {
      var fRowSpan;
      var mRowSpan;
      var fTr = this.getFrozenHeader().querySelectorAll('.e-columnheader');
      var mTr = this.getMovableHeader().querySelectorAll('.e-columnheader');

      for (var i = 0, len = fTr.length; i < len; i++) {
        fRowSpan = this.getRowSpan(fTr[i]);
        mRowSpan = this.getRowSpan(mTr[i]);

        if (fRowSpan.min > 1) {
          this.updateStackedHdrRowHgt(i, fRowSpan.max, fTr[i], mTr);
        } else if (mRowSpan.min > 1) {
          this.updateStackedHdrRowHgt(i, mRowSpan.max, mTr[i], fTr);
        }
      }

      if (this.parent.options.allowResizing) {
        this.updateResizeHandler();
      }
    };

    Freeze.prototype.getRowSpan = function (row) {
      var rSpan;
      var minRowSpan;
      var maxRowSpan;

      for (var i = 0, len = row.childElementCount; i < len; i++) {
        if (i === 0) {
          minRowSpan = row.children[0].rowSpan;
        }

        rSpan = row.children[i].rowSpan;
        minRowSpan = Math.min(rSpan, minRowSpan);
        maxRowSpan = Math.max(rSpan, minRowSpan);
      }

      return {
        min: minRowSpan,
        max: maxRowSpan
      };
    };

    Freeze.prototype.updateStackedHdrRowHgt = function (idx, maxRowSpan, row, rows) {
      var height = 0;

      for (var i = 0; i < maxRowSpan; i++) {
        height += rows[idx + i].style.height ? parseInt(rows[idx + i].style.height, 10) : rows[idx + i].offsetHeight;
      }

      row.style.height = height + 'px';
    };

    Freeze.prototype.getFrozenHeader = function () {
      return this.frozenHeader;
    };

    Freeze.prototype.getMovableHeader = function () {
      return this.movableHeader;
    };

    Freeze.prototype.refreshRowHeight = function () {
      if (this.parent.options.rowHeight != 0) {
        return;
      }

      if (this.parent.options.frozenColumns || this.parent.options.frozenRows) {
        this.clearWrapHeight();
        this.refreshFreeze({
          case: 'refreshHeight'
        });

        if (this.parent.options.allowResizing) {
          this.updateResizeHandler();
        }
      }
    };

    Freeze.prototype.clearWrapHeight = function () {
      var fn = function fn(fRows, mRows) {
        for (var i = 0, len = fRows.length; i < len; i++) {
          if (!sf.base.isNullOrUndefined(fRows[i]) && !sf.base.isNullOrUndefined(mRows[i])) {
            fRows[i].style.height = null;
            mRows[i].style.height = null;
          }
        }
      };

      var fRows;
      var mRows;

      if (this.parent.options.frozenColumns) {
        if (this.parent.options.frozenRows) {
          fRows = this.parent.element.querySelector('.e-frozenheader').querySelectorAll('tr');
          mRows = this.parent.element.querySelector('.e-movableheader').querySelectorAll('tr');
          fn(fRows, mRows);
        }

        fRows = this.parent.element.querySelector('.e-frozencontent').querySelectorAll('tr');
        mRows = this.parent.element.querySelector('.e-movablecontent').querySelectorAll('tr');
        fn(fRows, mRows);
      }

      if (this.parent.options.frozenRows && this.parent.options.frozenColumns == 0) {
        fRows = this.parent.element.querySelector('.e-headercontent').querySelectorAll('tr');
        mRows = this.parent.element.querySelector('.e-content').querySelectorAll('tr');
        fn(fRows, mRows);
      }
    };

    return Freeze;
  }();
  /**
   * Header drag and drop handling
   */


  var HeaderDragDrop =
  /** @class */
  function () {
    function HeaderDragDrop(parent) {
      var _this = this;

      this.dragStart = function (e) {
        var gObj = _this.parent;
        var popup = gObj.element.querySelector('.e-gridpopup');

        if (popup) {
          popup.style.display = 'none';
        }

        _this.parent.reorderModule.dragStart({
          target: e.target,
          column: _this.column,
          event: e.event
        });

        _this.parent.groupModule.columnDragStart({
          target: e.target,
          column: _this.column
        });

        e.bindEvents(e.dragElement);
      };

      this.drag = function (e) {
        var gObj = _this.parent;
        var target = e.target;

        if (target) {
          var closest$$1 = sf.base.closest(target, '.e-grid');

          var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');

          if (!closest$$1 || closest$$1.getAttribute('id') !== gObj.element.getAttribute('id')) {
            sf.base.classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);

            if (gObj.options.allowReordering) {
              gObj.element.querySelector('.e-reorderuparrow').style.display = 'none';
              gObj.element.querySelector('.e-reorderdownarrow').style.display = 'none';
            }

            if (!gObj.options.groupReordering) {
              return;
            }
          }

          if (gObj.options.allowReordering) {
            _this.parent.reorderModule.drag({
              target: e.target,
              column: _this.column,
              event: e.event
            });
          }

          if (gObj.options.allowGrouping) {
            _this.parent.groupModule.columnDrag({
              target: e.target
            });
          }
        }
      };

      this.dragStop = function (e) {
        var gObj = _this.parent;
        var cancel;
        var popup = gObj.element.querySelector('.e-gridpopup');

        if (popup) {
          popup.style.display = 'none';
        }

        if (!parentsUntil(e.target, 'e-headercell') && !parentsUntil(e.target, 'e-groupdroparea') || !gObj.options.allowReordering && parentsUntil(e.target, 'e-headercell') || !e.helper.getAttribute('e-mappinguid') && parentsUntil(e.target, 'e-groupdroparea')) {
          sf.base.remove(e.helper);
          cancel = true;
        }

        if (gObj.options.allowReordering) {
          _this.parent.reorderModule.dragStop({
            target: e.target,
            event: e.event,
            column: _this.column,
            cancel: cancel
          });
        }
      };

      this.drop = function (e) {
        var gObj = _this.parent;
        var uid = e.droppedElement.getAttribute('e-mappinguid');
        var closest$$1 = sf.base.closest(e.target, '.e-grid');
        sf.base.remove(e.droppedElement);

        if (closest$$1 && closest$$1.getAttribute('id') !== gObj.element.getAttribute('id') || !(gObj.options.allowReordering || gObj.options.allowGrouping)) {
          return;
        }

        if (gObj.options.allowReordering) {
          _this.parent.reorderModule.headerDrop({
            target: e.target
          });
        }

        if (gObj.options.allowGrouping) {
          _this.parent.groupModule.columnDrop({
            target: e.target,
            droppedElement: e.droppedElement
          });
        } //gObj.notify(events.headerDrop, { target: e.target, uid: uid, droppedElement: e.droppedElement });

      };

      this.helper = function (e) {
        var gObj = _this.parent;
        var target = e.sender.target;
        var parentEle = parentsUntil(target, 'e-headercell');

        if (!(gObj.options.allowReordering || gObj.options.allowGrouping) || !sf.base.isNullOrUndefined(parentEle) && parentEle.querySelectorAll('.e-checkselectall').length > 0) {
          return false;
        }

        var visualElement = sf.base.createElement('div', {
          className: 'e-cloneproperties e-dragclone e-headerclone'
        });
        var element = target.classList.contains('e-headercell') ? target : parentEle;

        if (!element || !gObj.options.allowReordering && element.classList.contains('e-stackedheadercell')) {
          return false;
        }

        var height = element.offsetHeight;
        var headercelldiv = element.querySelector('.e-headercelldiv') || element.querySelector('.e-stackedheadercelldiv');
        var col;

        if (headercelldiv) {
          if (element.querySelector('.e-stackedheadercelldiv')) {
            col = gObj.getStackedHeaderColumnByHeaderText(headercelldiv.innerText.trim(), gObj.options.columns);
          } else {
            col = gObj.getColumnByUid(headercelldiv.getAttribute('e-mappinguid'));
          }

          _this.column = col;

          if (_this.column.lockColumn) {
            return false;
          }

          visualElement.setAttribute('e-mappinguid', headercelldiv.getAttribute("e-mappinguid"));
        } // if (col && !isNullOrUndefined(col.headerTemplate)) {
        //     if (!isNullOrUndefined(col.headerTemplate)) {
        //         let result: Element[];
        //         let colIndex: number = gObj.getColumnIndexByField(col.field);
        //         result = col.getHeaderTemplate()(extend({ 'index': colIndex }, col), gObj, 'headerTemplate');
        //         appendChildren(visualElement, result);
        //     } else {
        //         visualElement.innerHTML = col.headerTemplate;
        //     }
        // } else {


        visualElement.innerHTML = headercelldiv ? col.headerText : element.firstElementChild.innerHTML; //}

        visualElement.style.width = element.offsetWidth + 'px';
        visualElement.style.height = element.offsetHeight + 'px';
        visualElement.style.lineHeight = (height - 6).toString() + 'px';
        gObj.element.appendChild(visualElement);
        return visualElement;
      };

      this.parent = parent;

      if (this.parent.options.allowGrouping || this.parent.options.allowReordering) {
        this.initializeHeaderDrag();
        this.initializeHeaderDrop();
      }
    }

    HeaderDragDrop.prototype.initializeHeaderDrag = function () {
      var gObj = this.parent;

      if (!(this.parent.options.allowReordering || this.parent.options.allowGrouping && this.parent.options.showDropArea)) {
        return;
      }

      var headerRows = [].slice.call(gObj.getHeaderContent().querySelectorAll('.e-columnheader'));

      for (var i = 0, len = headerRows.length; i < len; i++) {
        var drag = new sf.base.Draggable(headerRows[i], {
          dragTarget: '.e-headercell',
          distance: 5,
          helper: this.helper,
          dragStart: this.dragStart,
          drag: this.drag,
          dragStop: this.dragStop,
          abort: '.e-rhandler'
        });
      }
    };

    HeaderDragDrop.prototype.initializeHeaderDrop = function () {
      var gObj = this.parent;
      var drop = new sf.base.Droppable(gObj.getHeaderContent(), {
        accept: '.e-dragclone',
        drop: this.drop
      });
    };

    return HeaderDragDrop;
  }();
  /**
   * ColumnDrop Handling
   */


  var ContentDragDrop =
  /** @class */
  function () {
    function ContentDragDrop(parent) {
      var _this = this;

      this.drop = function (e) {
        _this.parent.groupModule.columnDrop({
          target: e.target,
          droppedElement: e.droppedElement
        });

        sf.base.remove(e.droppedElement);
      };

      this.parent = parent;

      if (this.parent.options.allowGrouping) {
        this.initializeContentDrop();
      }
    }

    ContentDragDrop.prototype.initializeContentDrop = function () {
      var gObj = this.parent;
      var drop = new sf.base.Droppable(gObj.getContent(), {
        accept: '.e-dragclone',
        drop: this.drop
      });
    };

    return ContentDragDrop;
  }();
  /**
   * Column reorder handling
   */


  var Reorder =
  /** @class */
  function () {
    function Reorder(parent) {
      this.parent = parent;

      if (parent.options.allowReordering) {
        this.createReorderElement();
      }
    }

    Reorder.prototype.chkDropPosition = function (srcElem, destElem) {
      var col = this.parent.getColumnByUid(destElem.firstElementChild.getAttribute('e-mappinguid'));
      var bool = col ? !col.lockColumn : true;
      return (srcElem.parentElement.isEqualNode(destElem.parentElement) || this.parent.options.frozenColumns && Array.prototype.indexOf.call(sf.base.closest(srcElem, 'thead').children, srcElem.parentElement) === Array.prototype.indexOf.call(sf.base.closest(destElem, 'thead').children, destElem.parentElement)) && this.targetParentContainerIndex(srcElem, destElem) > -1 && bool;
    };

    Reorder.prototype.chkDropAllCols = function (srcElem, destElem) {
      var isFound;
      var headers = this.getHeaderCells();
      var header;

      while (!isFound && headers.length > 0) {
        header = headers.pop();
        isFound = srcElem !== header && this.targetParentContainerIndex(srcElem, destElem) > -1;
      }

      return isFound;
    };

    Reorder.prototype.findColParent = function (col, cols, parent) {
      parent = parent;

      for (var i = 0, len = cols.length; i < len; i++) {
        if (col === cols[i]) {
          return true;
        } else if (cols[i].columns) {
          var cnt = parent.length;
          parent.push(cols[i]);

          if (!this.findColParent(col, cols[i].columns, parent)) {
            parent.splice(cnt, parent.length - cnt);
          } else {
            return true;
          }
        }
      }

      return false;
    };

    Reorder.prototype.getColumnsModel = function (cols) {
      var columnModel = [];
      var subCols = [];

      for (var i = 0, len = cols.length; i < len; i++) {
        columnModel.push(cols[i]);

        if (cols[i].columns) {
          subCols = subCols.concat(cols[i].columns);
        }
      }

      if (subCols.length) {
        columnModel = columnModel.concat(this.getColumnsModel(subCols));
      }

      return columnModel;
    };

    Reorder.prototype.headerDrop = function (e) {
      var gObj = this.parent;
      var dropElement = this.element.querySelector('.e-headercelldiv') || this.element.querySelector('.e-stackedheadercelldiv');
      var uId = dropElement.getAttribute('e-mappinguid');
      var column = gObj.getColumnByUid(uId);

      if (!sf.base.closest(e.target, 'th') || !sf.base.isNullOrUndefined(column) && (!column.allowReordering || column.lockColumn)) {
        return;
      }

      var destElem = sf.base.closest(e.target, '.e-headercell');
      var destElemDiv = destElem.querySelector('.e-headercelldiv') || destElem.querySelector('.e-stackedheadercelldiv');
      var destElemUid = destElemDiv.getAttribute('e-mappinguid');

      if (!sf.base.isNullOrUndefined(destElemUid)) {
        var destColumn = gObj.getColumnByUid(destElemUid);

        if (sf.base.isNullOrUndefined(destColumn) || !destColumn.allowReordering || destColumn.lockColumn) {
          return;
        }
      }

      if (destElem && !(!this.chkDropPosition(this.element, destElem) || !this.chkDropAllCols(this.element, destElem))) {
        if (this.parent.options.enableColumnVirtualization) {
          var columns = this.parent.options.columns;
          var sourceUid_1 = this.element.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');
          var col = this.parent.getColumns(true).filter(function (col) {
            return col.uid === sourceUid_1;
          });
          var colMatchIndex_1 = null;
          var column_1 = col[0];
          var destUid_1 = destElem.querySelector('.e-headercelldiv').getAttribute('e-mappinguid');
          var bool = columns.some(function (col, index) {
            if (col.uid === destUid_1) {
              colMatchIndex_1 = index;
              return col.uid === destUid_1;
            }

            return false;
          });

          if (!sf.base.isNullOrUndefined(colMatchIndex_1)) {
            this.moveColumns(colMatchIndex_1, column_1);
          }
        } else {
          var newIndex = this.targetParentContainerIndex(this.element, destElem);
          var uid = this.element.firstElementChild.getAttribute('e-mappinguid');
          this.destElement = destElem;

          if (uid) {
            this.moveColumns(newIndex, this.parent.getColumnByUid(uid));
          } else {
            var headers = this.getHeaderCells();
            var oldIdx = getElementIndex(this.element, headers);
            var columns = this.getColumnsModel(this.parent.options.columns);
            var column_2 = columns[oldIdx];
            this.moveColumns(newIndex, column_2);
          }
        }
      }
    };

    Reorder.prototype.isActionPrevent = function (gObj) {
      return isActionPrevent(gObj.element);
    };

    Reorder.prototype.moveColumns = function (destIndex, column, reorderByColumn, preventRefresh) {
      var gObj = this.parent;

      if (this.isActionPrevent(gObj)) {
        //gObj.notify(events.preventBatch, { instance: this, handler: this.moveColumns, arg1: destIndex, arg2: column });
        return;
      }

      var parent = this.getColParent(column, this.parent.options.columns);
      var cols = parent ? parent.columns : this.parent.options.columns;
      var srcIdx = inArray(column, cols);

      if (this.parent.options.frozenColumns && parent && !reorderByColumn) {
        for (var i = 0; i < cols.length; i++) {
          if (cols[i].field === column.field) {
            srcIdx = i;
            break;
          }
        }

        var col = this.parent.getColumnByUid(this.destElement.firstElementChild.getAttribute('e-mappinguid'));

        if (col) {
          for (var i = 0; i < cols.length; i++) {
            if (cols[i].field === col.field) {
              destIndex = i;
              break;
            }
          }
        } else {
          for (var i = 0; i < cols.length; i++) {
            if (cols[i].headerText === this.destElement.innerText.trim()) {
              destIndex = i;
            }
          }
        }
      }

      if (!gObj.options.allowReordering || srcIdx === destIndex || srcIdx === -1 || destIndex === -1) {
        return;
      }

      cols.splice(destIndex, 0, cols.splice(srcIdx, 1)[0]);
      gObj.getColumns(true); //gObj.notify(events.columnPositionChanged, { fromIndex: destIndex, toIndex: srcIdx });

      if (preventRefresh !== false) {
        //TODO: reorder from here
        gObj.dotNetRef.invokeMethodAsync("ColumnReordered", {
          requestType: 'reorder',
          fromIndex: destIndex,
          toIndex: srcIdx,
          toColumnUid: column.uid
        });
      }
    };

    Reorder.prototype.targetParentContainerIndex = function (srcElem, destElem) {
      var headers = this.getHeaderCells();
      var cols = this.parent.options.columns;
      var flatColumns = this.getColumnsModel(cols);
      var parent = this.getColParent(flatColumns[getElementIndex(srcElem, headers)], cols);
      cols = parent ? parent.columns : cols;
      return inArray(flatColumns[getElementIndex(destElem, headers)], cols);
    };

    Reorder.prototype.getHeaderCells = function () {
      var frozenColumns = this.parent.options.frozenColumns;

      if (frozenColumns) {
        var fTh = void 0;
        var mTh = void 0;
        var fHeaders = [];
        var fRows = [].slice.call(this.parent.element.querySelector(".e-frozenheader").querySelectorAll('.e-columnheader'));

        if (frozenColumns) {
          var mRows = [].slice.call(this.parent.getHeaderContent().querySelector('.e-movableheader').querySelectorAll('.e-columnheader'));

          for (var i = 0; i < fRows.length; i++) {
            fTh = [].slice.call(fRows[i].getElementsByClassName('e-headercell'));
            mTh = [].slice.call(mRows[i].getElementsByClassName('e-headercell'));
            var isAvail = void 0;

            for (var k = 0; k < fTh.length; k++) {
              for (var j = 0; j < mTh.length; j++) {
                if (mTh[j].innerText === fTh[k].innerText) {
                  isAvail = true;
                  break;
                }
              }

              if (!isAvail) {
                fHeaders = fHeaders.concat([fTh[k]]);
              }
            }

            for (var j = 0; j < mTh.length; j++) {
              fHeaders.push(mTh[j]);
            }
          }
        } else {
          for (var i = 0; i < fRows.length; i++) {
            mTh = [].slice.call(fRows[i].getElementsByClassName('e-headercell'));

            for (var k = 0; k < mTh.length; k++) {
              var isAvail = void 0;

              for (var j = k + 1; j < mTh.length; j++) {
                if (mTh[j].innerText === mTh[k].innerText) {
                  isAvail = true;
                  break;
                }
              }

              if (!isAvail) {
                fHeaders = fHeaders.concat([mTh[k]]);
              }
            }
          }
        }

        return fHeaders;
      } else {
        return [].slice.call(this.parent.element.getElementsByClassName('e-headercell'));
      }
    };

    Reorder.prototype.getColParent = function (column, columns) {
      var parents = [];
      this.findColParent(column, columns, parents);
      return parents[parents.length - 1];
    };

    Reorder.prototype.reorderSingleColumn = function (fromFName, toFName) {
      var fColumn = this.parent.getColumnByField(fromFName);
      var toColumn = this.parent.getColumnByField(toFName);

      if (!sf.base.isNullOrUndefined(fColumn) && (!fColumn.allowReordering || fColumn.lockColumn) || !sf.base.isNullOrUndefined(toColumn) && (!toColumn.allowReordering || fColumn.lockColumn)) {
        return;
      }

      var column = this.parent.getColumnByField(toFName);
      var parent = this.getColParent(column, this.parent.options.columns);
      var columns = parent ? parent.columns : this.parent.options.columns;
      var destIndex = inArray(column, columns);

      if (destIndex > -1) {
        this.moveColumns(destIndex, this.parent.getColumnByField(fromFName), true);
      }
    };

    Reorder.prototype.reorderMultipleColumns = function (fromFNames, toFName) {
      var toIndex = this.parent.getColumnIndexByField(toFName);
      var toColumn = this.parent.getColumnByField(toFName);

      if (toIndex < 0 || !sf.base.isNullOrUndefined(toColumn) && (!toColumn.allowReordering || toColumn.lockColumn)) {
        return;
      }

      for (var i = 0; i < fromFNames.length; i++) {
        var column = this.parent.getColumnByField(fromFNames[i]);

        if (!sf.base.isNullOrUndefined(column) && (!column.allowReordering || column.lockColumn)) {
          return;
        }
      }

      for (var i = 0; i < fromFNames.length; i++) {
        var column = this.parent.getColumnByIndex(toIndex);
        var parent_1 = this.getColParent(column, this.parent.options.columns);
        var columns = parent_1 ? parent_1.columns : this.parent.options.columns;
        var destIndex = inArray(column, columns);

        if (destIndex > -1) {
          this.moveColumns(destIndex, this.parent.getColumnByField(fromFNames[i]), true, false);
        }

        if (this.parent.getColumnIndexByField(fromFNames[i + 1]) >= destIndex) {
          toIndex++; //R to L
        }
      }

      var cols = this.parent.getColumns();
      this.parent.dotNetRef.invokeMethodAsync("ColumnReordered", {
        fromColumnUid: fromFNames.map(function (name) {
          return cols.filter(function (col) {
            return col.field === name;
          })[0].uid;
        }),
        toColumnUid: toColumn.uid,
        isMultipleReorder: true,
        requestType: 'reorder',
        type: 'actionBegin'
      });
    };

    Reorder.prototype.moveTargetColumn = function (column, toIndex) {
      if (toIndex > -1) {
        this.moveColumns(toIndex, column, true);
      }
    };

    Reorder.prototype.reorderSingleColumnByTarget = function (fieldName, toIndex) {
      var column = this.parent.getColumnByField(fieldName);
      this.moveTargetColumn(column, toIndex);
    };

    Reorder.prototype.reorderMultipleColumnByTarget = function (fieldName, toIndex) {
      for (var i = 0; i < fieldName.length; i++) {
        this.reorderSingleColumnByTarget(fieldName[i], toIndex);
      }
    };
    /**
     * Changes the position of the Grid columns by field names.
     * @param  {string | string[]} fromFName - Defines the origin field names.
     * @param  {string} toFName - Defines the destination field name.
     * @return {void}
     */


    Reorder.prototype.reorderColumns = function (fromFName, toFName) {
      if (typeof fromFName === 'string') {
        this.reorderSingleColumn(fromFName, toFName);
        this.fromCol = fromFName;
      } else {
        this.reorderMultipleColumns(fromFName, toFName);
        this.fromCol = fromFName[0];
      }
    };
    /**
     * Changes the position of the Grid columns by field index.
     * @param  {number} fromIndex - Defines the origin field index.
     * @param  {number} toIndex - Defines the destination field index.
     * @return {void}
     */


    Reorder.prototype.reorderColumnByIndex = function (fromIndex, toIndex) {
      var column = this.parent.getColumnByIndex(fromIndex);
      this.moveTargetColumn(column, toIndex);
    };
    /**
     * Changes the position of the Grid columns by field index.
     * @param  {string | string[]} fieldName - Defines the field name.
     * @param  {number} toIndex - Defines the destination field index.
     * @return {void}
     */


    Reorder.prototype.reorderColumnByTargetIndex = function (fieldName, toIndex) {
      typeof fieldName === 'string' ? this.reorderSingleColumnByTarget(fieldName, toIndex) : this.reorderMultipleColumnByTarget(fieldName, toIndex);
    };

    Reorder.prototype.createReorderElement = function () {
      var header = this.parent.element.querySelector('.e-headercontent');
      this.upArrow = header.appendChild(sf.base.createElement('div', {
        className: 'e-icons e-icon-reorderuparrow e-reorderuparrow',
        attrs: {
          style: 'display:none'
        }
      }));
      this.downArrow = header.appendChild(sf.base.createElement('div', {
        className: 'e-icons e-icon-reorderdownarrow e-reorderdownarrow',
        attrs: {
          style: 'display:none'
        }
      }));
    };
    /**
     * The function used to trigger onActionComplete
     * @return {void}
     * @hidden
     */
    // public onActionComplete(e: NotifyArgs): void {
    //     if (isBlazor() && !this.parent.isJsComponent) {
    //         e.rows = null;
    //     }
    //     this.parent.trigger(events.actionComplete, extend(e, { type: events.actionComplete }));
    //     let target: Element = this.fromCol && this.parent.getColumnHeaderByField(this.fromCol);
    //     if (target) {
    //         this.parent.focusModule.onClick({ target }, true);
    //     }
    // }

    /**
     * To destroy the reorder
     * @return {void}
     * @hidden
     */


    Reorder.prototype.destroy = function () {
      var gridElement = this.parent.element;

      if (this.upArrow) {
        sf.base.remove(this.upArrow);
      }

      if (this.downArrow) {
        sf.base.remove(this.downArrow);
      } //call ejdrag and drop destroy

    };

    Reorder.prototype.keyPressHandler = function (e) {
      var gObj = this.parent;

      switch (e.action) {
        case 'ctrlLeftArrow':
        case 'ctrlRightArrow':
          // let element: HTMLElement = gObj.focusModule.currentInfo.element;
          // if (element && element.classList.contains('e-headercell')) {
          //     let column: Column = gObj.getColumnByUid(element.firstElementChild.getAttribute('e-mappinguid'));
          //     let visibleCols: Column[] = gObj.getVisibleColumns();
          //     let index: number = visibleCols.indexOf(column);
          //     let toCol: Column = e.action === 'ctrlLeftArrow' ? visibleCols[index - 1] : visibleCols[index + 1];
          //     if (toCol && toCol.field && column.field) {
          //         this.reorderColumns(column.field, toCol.field);
          //     }
          // }
          break;
      }
    };

    Reorder.prototype.drag = function (e) {
      var gObj = this.parent;
      var target = e.target;

      if (!e.column.allowReordering || e.column.lockColumn) {
        return;
      }

      var closest$$1 = sf.base.closest(target, '.e-headercell:not(.e-stackedHeaderCell)');
      var cloneElement = gObj.element.querySelector('.e-cloneproperties');
      var isLeft = this.x > getPosition(e.event).x + gObj.getContent().firstElementChild.scrollLeft;
      sf.base.removeClass(gObj.element.querySelector(".e-headercontent").querySelectorAll('.e-reorderindicate'), ['e-reorderindicate']);
      this.setDisplay('none');
      this.stopTimer();
      sf.base.classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);
      this.updateScrollPostion(e.event);

      if (closest$$1 && !closest$$1.isEqualNode(this.element)) {
        target = closest$$1; //consider stacked, detail header cell 

        if (!(!this.chkDropPosition(this.element, target) || !this.chkDropAllCols(this.element, target))) {
          this.updateArrowPosition(target, isLeft);
          sf.base.classList(target, ['e-allowDrop', 'e-reorderindicate'], []);
        } else if (!(gObj.options.allowGrouping && parentsUntil(e.target, 'e-groupdroparea'))) {
          sf.base.classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);
        }
      } //gObj.trigger(events.columnDrag, { target: target, draggableType: 'headercell', column: e.column });

    };

    Reorder.prototype.updateScrollPostion = function (e) {
      var _this = this;

      var frzCols = this.parent.options.frozenColumns;
      var x = getPosition(e).x;
      var cliRect = this.parent.element.getBoundingClientRect();
      var cliRectBaseLeft = frzCols ? this.parent.element.querySelector('.e-movableheader').getBoundingClientRect().left : cliRect.left;
      var cliRectBaseRight = cliRect.right;
      var scrollElem = frzCols ? this.parent.getContent().querySelector('.e-movablecontent') : this.parent.getContent().firstElementChild;

      if (x > cliRectBaseLeft && x < cliRectBaseLeft + 35) {
        this.timer = window.setInterval(function () {
          _this.setScrollLeft(scrollElem, true);
        }, 50);
      } else if (x < cliRectBaseRight && x > cliRectBaseRight - 35) {
        this.timer = window.setInterval(function () {
          _this.setScrollLeft(scrollElem, false);
        }, 50);
      }
    };

    Reorder.prototype.setScrollLeft = function (scrollElem, isLeft) {
      var scrollLeft = scrollElem.scrollLeft;
      scrollElem.scrollLeft = scrollElem.scrollLeft + (isLeft ? -5 : 5);

      if (scrollLeft !== scrollElem.scrollLeft) {
        this.setDisplay('none');
      }
    };

    Reorder.prototype.stopTimer = function () {
      window.clearInterval(this.timer);
    };

    Reorder.prototype.updateArrowPosition = function (target, isLeft) {
      var cliRect = target.getBoundingClientRect();
      var cliRectBase = this.parent.element.getBoundingClientRect();

      if (isLeft && cliRect.left < cliRectBase.left || !isLeft && cliRect.right > cliRectBase.right) {
        return;
      }

      this.upArrow.style.top = cliRect.top + cliRect.height - cliRectBase.top + 'px';
      this.downArrow.style.top = cliRect.top - cliRectBase.top - 4 + 'px';
      this.upArrow.style.left = this.downArrow.style.left = (isLeft ? cliRect.left : cliRect.right) - cliRectBase.left - 4 + 'px';
      this.setDisplay('');
    };

    Reorder.prototype.dragStart = function (e) {
      var gObj = this.parent;
      var target = e.target;
      this.element = target.classList.contains('e-headercell') ? target : parentsUntil(target, 'e-headercell');

      if (!e.column.allowReordering || e.column.lockColumn) {
        return;
      }

      this.x = getPosition(e.event).x + gObj.getContent().firstElementChild.scrollLeft; // gObj.trigger(events.columnDragStart, {
      //     target: target as Element, draggableType: 'headercell', column: e.column
      // });
    };

    Reorder.prototype.dragStop = function (e) {
      var gObj = this.parent;
      this.setDisplay('none');
      this.stopTimer();

      if (!e.cancel) {//gObj.trigger(events.columnDrop, { target: e.target, draggableType: 'headercell', column: e.column });
      }

      sf.base.removeClass(gObj.element.querySelector(".e-headercontent").querySelectorAll('.e-reorderindicate'), ['e-reorderindicate']);
    };

    Reorder.prototype.setDisplay = function (display) {
      this.upArrow.style.display = display;
      this.downArrow.style.display = display;
    };
    /**
     * For internal use only - Get the module name.
     * @private
     */


    Reorder.prototype.getModuleName = function () {
      return 'reorder';
    };

    return Reorder;
  }();
  /**
   * ColumnWidthService
   * @hidden
   */


  var ColumnWidthService =
  /** @class */
  function () {
    function ColumnWidthService(parent) {
      this.parent = parent;
    }

    ColumnWidthService.prototype.setMinwidthBycalculation = function (tWidth) {
      var difference = 0;
      var collection = this.parent.getColumns().filter(function (a) {
        return sf.base.isNullOrUndefined(a.width) || a.width === 'auto';
      });

      if (collection.length) {
        if (!sf.base.isNullOrUndefined(this.parent.options.width) && this.parent.options.width !== 'auto') {
          difference = (typeof this.parent.options.width === 'string' ? parseInt(this.parent.options.width, 10) : this.parent.options.width) - tWidth;
        }

        var tmWidth = 0;

        for (var _i = 0, collection_1 = collection; _i < collection_1.length; _i++) {
          var cols = collection_1[_i];
          tmWidth += !sf.base.isNullOrUndefined(cols.minWidth) ? typeof cols.minWidth === 'string' ? parseInt(cols.minWidth, 10) : cols.minWidth : 0;
        }

        for (var i = 0; i < collection.length; i++) {
          if (tWidth === 0 && this.parent.options.allowResizing && this.isWidthUndefined() && i !== collection.length - 1) {
            this.setUndefinedColumnWidth(collection);
          }

          if (tWidth !== 0 && difference < tmWidth) {
            this.setWidth(collection[i].minWidth, this.parent.getColumnIndexByField(collection[i].field));
          } else if (tWidth !== 0 && difference > tmWidth) {
            this.setWidth('', this.parent.getColumnIndexByField(collection[i].field), true);
          }
        }
      }
    };

    ColumnWidthService.prototype.setUndefinedColumnWidth = function (collection) {
      for (var k = 0; k < collection.length; k++) {
        if (k !== collection.length - 1) {
          collection[k].width = 200;
          this.setWidth(200, this.parent.getColumnIndexByField(collection[k].field));
        }
      }
    };

    ColumnWidthService.prototype.setColumnWidth = function (column, index, module) {
      if (this.parent.getColumns().length < 1) {
        return;
      }

      var columnIndex = sf.base.isNullOrUndefined(index) ? this.parent.getNormalizedColumnIndex(column.uid) : index;
      var cWidth = this.getWidth(column);
      var tgridWidth = this.getTableWidth(this.parent.getColumns());

      if (cWidth !== null) {
        this.setWidth(cWidth, columnIndex);

        if (this.parent.options.width !== 'auto' && this.parent.options.width.toString().indexOf('%') === -1) {
          this.setMinwidthBycalculation(tgridWidth);
        }

        if (this.parent.options.allowResizing && module === 'resize' || this.parent.options.frozenColumns && this.parent.options.allowResizing) {
          this.setWidthToTable();
        }

        this.parent.dotNetRef.invokeMethodAsync("ColumnWidthChanged", {
          index: columnIndex,
          width: cWidth,
          columnUid: column.uid
        });
      }
    };

    ColumnWidthService.prototype.setWidth = function (width, index, clear) {
      var chrome = 'chrome';
      var webstore = 'webstore';

      if (typeof width === 'string' && width.indexOf('%') !== -1 && !(Boolean(window[chrome]) && Boolean(window[chrome][webstore])) && this.parent.options.allowGrouping) {
        var elementWidth = this.parent.element.offsetWidth;
        width = parseInt(width, 10) / 100 * elementWidth;
      }

      var header = this.parent.getHeaderTable();
      var content = this.parent.getContentTable();
      var fWidth = sf.base.formatUnit(width);
      var headerCol;
      var frzCols = this.parent.options.frozenColumns;
      var mHdr = this.parent.getHeaderContent().querySelector('.e-movableheader');
      var mCont = this.parent.getContent().querySelector('.e-movablecontent');

      if (frzCols && index >= frzCols && mHdr && mHdr.querySelector('colgroup')) {
        headerCol = mHdr.querySelector('colgroup').children[index - frzCols];
      } else if (this.parent.options.enableColumnVirtualization && frzCols && mHdr.scrollLeft > 0) {
        var colGroup = mHdr.querySelector('colgroup');
        headerCol = colGroup.children[colGroup.children.length - 1 - index];
      } else {
        headerCol = header.querySelector('colgroup').children[index];
      }

      if (headerCol && !clear) {
        headerCol.style.width = fWidth;
      } else if (headerCol && clear) {
        headerCol.style.width = ' ';
      }

      var contentCol;

      if (frzCols && index >= frzCols) {
        contentCol = this.parent.getContent().querySelector('.e-movablecontent').querySelector('colgroup').children[index - frzCols];
      } else if (this.parent.options.enableColumnVirtualization && frzCols && mCont.scrollLeft > 0) {
        var colGroup = this.parent.getContent().querySelector('.e-movablecontent').querySelector('colgroup');
        contentCol = colGroup.children[colGroup.children.length - 1 - index];
      } else {
        contentCol = content.querySelector('colgroup').children[index];
      }

      if (contentCol && !clear) {
        contentCol.style.width = fWidth;
      } else if (contentCol && clear) {
        contentCol.style.width = ' ';
      }

      if (this.parent.options.aggregatesCount != 0) {
        var footerCol = void 0;

        if (frzCols && index >= frzCols) {
          footerCol = this.parent.getFooterContent().querySelector('.e-movablefootercontent').querySelector('colgroup').children[index - frzCols];
        } else {
          footerCol = this.parent.getFooterContent().querySelector('colgroup').children[index];
        }

        if (contentCol && !clear) {
          footerCol.style.width = fWidth;
        } else if (contentCol && clear) {
          footerCol.style.width = ' ';
        }
      }

      var edit = this.parent.element.querySelectorAll('.e-table.e-inline-edit');
      var editTableCol = [];

      for (var i = 0; i < edit.length; i++) {
        if (parentsUntil(edit[i], 'e-grid').id === this.parent.element.id) {
          for (var j = 0; j < edit[i].querySelector('colgroup').children.length; j++) {
            editTableCol.push(edit[i].querySelector('colgroup').children[j]);
          }
        }
      }

      if (edit.length && editTableCol.length) {
        editTableCol[index].style.width = fWidth;
      }
    };

    ColumnWidthService.prototype.isWidthUndefined = function () {
      var isWidUndefCount = this.parent.getColumns().filter(function (col) {
        return sf.base.isNullOrUndefined(col.width) && sf.base.isNullOrUndefined(col.minWidth);
      }).length;
      return this.parent.getColumns().length === isWidUndefCount;
    };

    ColumnWidthService.prototype.getWidth = function (column) {
      //TODO: move it to c# side
      // if (isNullOrUndefined(column.width) && this.parent.options.allowResizing
      //     && isNullOrUndefined(column.minWidth) && !this.isWidthUndefined()) {
      //     column.width = 200;
      // }
      // if (this.parent.options.frozenColumns && isNullOrUndefined(column.width) &&
      //     column.index < this.parent.options.frozenColumns) {
      //     column.width = 200;
      // }
      if (!column.width) {
        return null;
      }

      var width = parseInt(column.width.toString(), 10);

      if (column.minWidth && width < parseInt(column.minWidth.toString(), 10)) {
        return column.minWidth;
      } else if (column.maxWidth && width > parseInt(column.maxWidth.toString(), 10)) {
        return column.maxWidth;
      } else {
        return column.width;
      }
    };

    ColumnWidthService.prototype.getTableWidth = function (columns) {
      var tWidth = 0;

      for (var _i = 0, columns_1 = columns; _i < columns_1.length; _i++) {
        var column = columns_1[_i];
        var cWidth = this.getWidth(column);

        if (column.width === 'auto') {
          cWidth = 0;
        }

        if (column.visible !== false && cWidth !== null) {
          tWidth += parseInt(cWidth.toString(), 10);
        }
      }

      return tWidth;
    };

    ColumnWidthService.prototype.calcMovableOrFreezeColWidth = function (tableType) {
      var columns = this.parent.getColumns().slice();

      if (tableType === 'movable') {
        columns.splice(0, this.parent.options.frozenColumns);
      } else if (tableType === 'freeze') {
        columns.splice(this.parent.options.frozenColumns, columns.length);
      }

      return sf.base.formatUnit(this.getTableWidth(columns));
    };

    ColumnWidthService.prototype.setWidthToFrozenTable = function () {
      var freezeWidth = this.calcMovableOrFreezeColWidth('freeze');
      this.parent.getHeaderTable().style.width = freezeWidth;
      this.parent.getContentTable().style.width = freezeWidth;

      if (this.parent.getFooterContent() && this.parent.getFooterContent().querySelector('.e-frozenfootercontent').firstElementChild) {
        this.parent.getFooterContent().querySelector('.e-frozenfootercontent').firstElementChild.style.width = freezeWidth;
      }
    };

    ColumnWidthService.prototype.setWidthToMovableTable = function () {
      var movableWidth = '';
      var isColUndefined = this.parent.getColumns().filter(function (a) {
        return sf.base.isNullOrUndefined(a.width);
      }).length >= 1;
      var isWidthAuto = this.parent.getColumns().filter(function (a) {
        return a.width === 'auto';
      }).length >= 1;

      if (typeof this.parent.options.width === 'number' && !isColUndefined && !isWidthAuto) {
        movableWidth = sf.base.formatUnit(this.parent.options.width - parseInt(this.calcMovableOrFreezeColWidth('freeze').split('px')[0], 10) - 5);
      } else if (!isColUndefined && !isWidthAuto) {
        movableWidth = this.calcMovableOrFreezeColWidth('movable');
      }

      if (this.parent.getHeaderContent().querySelector('.e-movableheader').firstElementChild) {
        this.parent.getHeaderContent().querySelector('.e-movableheader').firstElementChild.style.width = movableWidth;
      }

      if (this.parent.getFooterContent() && this.parent.getFooterContent().querySelector('.e-movablefootercontent').firstElementChild) {
        this.parent.getFooterContent().querySelector('.e-movablefootercontent').firstElementChild.style.width = movableWidth;
      }

      this.parent.getContent().querySelector('.e-movablecontent').firstElementChild.style.width = movableWidth;
    };

    ColumnWidthService.prototype.setWidthToFrozenEditTable = function () {
      var freezeWidth = this.calcMovableOrFreezeColWidth('freeze');
      this.parent.element.querySelectorAll('.e-table.e-inline-edit')[0].style.width = freezeWidth;
    };

    ColumnWidthService.prototype.setWidthToMovableEditTable = function () {
      var movableWidth = this.calcMovableOrFreezeColWidth('movable');
      this.parent.element.querySelectorAll('.e-table.e-inline-edit')[1].style.width = movableWidth;
    };

    ColumnWidthService.prototype.setWidthToTable = function () {
      var tWidth = sf.base.formatUnit(this.getTableWidth(this.parent.getColumns()));

      if (this.parent.options.frozenColumns) {
        this.setWidthToFrozenTable();
        this.setWidthToMovableTable();
      } else {
        // if (this.parent.options.hasDetailTemplate) {
        //     this.setColumnWidth(new Column({ width: '30px' }));
        // }
        this.parent.getHeaderTable().style.width = tWidth;
        this.parent.getContentTable().style.width = tWidth;

        if (this.parent.options.aggregatesCount != 0) {
          this.parent.getFooterContent().querySelector(".e-table").style.width = tWidth;
        }
      }

      var edit = this.parent.element.querySelector('.e-table.e-inline-edit');

      if (edit && this.parent.options.frozenColumns) {
        this.setWidthToFrozenEditTable();
        this.setWidthToMovableEditTable();
      } else if (edit) {
        edit.style.width = tWidth;
      }
    };

    return ColumnWidthService;
  }();

  var resizeClassList = {
    root: 'e-rhandler',
    suppress: 'e-rsuppress',
    icon: 'e-ricon',
    helper: 'e-rhelper',
    header: 'th.e-headercell',
    cursor: 'e-rcursor'
  };
  /**
   * Resize handler
   */

  var Resize =
  /** @class */
  function () {
    function Resize(parent) {
      this.tapped = false;
      this.isDblClk = true;
      this.parent = parent;
      this.widthService = new ColumnWidthService(this.parent);
    }
    /**
     * Resize by field names.
     * @param  {string|string[]} fName - Defines the field name.
     * @return {void}
     */


    Resize.prototype.autoFitColumns = function (fName) {
      var columnName = fName === undefined || fName === null || fName.length <= 0 ? this.parent.getColumns().map(function (x) {
        return x.field;
      }) : typeof fName === 'string' ? [fName] : fName;
      this.findColumn(columnName);
    };

    Resize.prototype.autoFit = function () {
      var newarray = this.parent.getColumns().filter(function (c) {
        return c.autoFit === true;
      }).map(function (c) {
        return c.field || c.headerText;
      });

      if (newarray.length > 0) {
        this.autoFitColumns(newarray);
      }
    };
    /* tslint:disable-next-line:max-func-body-length */


    Resize.prototype.resizeColumn = function (fName, index, id) {
      var gObj = this.parent;
      var tWidth = 0;
      var headerTable;
      var contentTable;
      var footerTable;
      var headerDivTag = 'e-gridheader';
      var contentDivTag = 'e-gridcontent';
      var footerDivTag = 'e-gridfooter';
      var indentWidth = 0;
      var uid = id ? id : this.parent.getUidByColumnField(fName);
      var columnIndex = this.parent.getNormalizedColumnIndex(uid);
      var headerTextClone;
      var contentTextClone;
      var footerTextClone;
      var columnIndexByField = this.parent.getColumnIndexByField(fName);
      var frzCols = gObj.options.frozenColumns;

      if (!sf.base.isNullOrUndefined(gObj.getFooterContent())) {
        footerTable = gObj.getFooterContent().querySelector('.e-table');
      }

      if (frzCols) {
        if (index < frzCols) {
          headerTable = gObj.getHeaderTable();
          contentTable = gObj.getContentTable();
          headerTextClone = headerTable.querySelector('[e-mappinguid="' + uid + '"]').parentElement.cloneNode(true);
          contentTextClone = contentTable.querySelectorAll("td:nth-child(" + (columnIndex + 1) + ")");

          if (footerTable) {
            footerTextClone = footerTable.querySelectorAll("td:nth-child(" + (columnIndex + 1) + ")");
          }
        } else {
          headerTable = gObj.getHeaderContent().querySelector('.e-movableheader').children[0];
          contentTable = gObj.getContent().querySelector('.e-movablecontent').children[0];
          headerTextClone = headerTable.querySelector('[e-mappinguid="' + uid + '"]').parentElement.cloneNode(true);
          contentTextClone = contentTable.querySelectorAll("td:nth-child(" + (columnIndex - frzCols + 1) + ")");

          if (footerTable) {
            footerTable = gObj.getFooterContent().querySelector('.e-movablefootercontent').children[0];
            footerTextClone = footerTable.querySelectorAll("td:nth-child(" + (columnIndex - frzCols + 1) + ")");
          }
        }
      } else {
        headerTable = gObj.getHeaderTable();
        contentTable = gObj.getContentTable();
        headerTextClone = headerTable.querySelector('[e-mappinguid="' + uid + '"]').parentElement.cloneNode(true);
        contentTextClone = contentTable.querySelectorAll("td:nth-child(" + (columnIndex + 1) + "):not(.e-groupcaption)");

        if (footerTable) {
          footerTextClone = footerTable.querySelectorAll("td:nth-child(" + (columnIndex + 1) + "):not(.e-groupcaption)");
        }
      }

      var indentWidthClone = headerTable.querySelector('tr').querySelectorAll('.e-grouptopleftcell');

      if (indentWidthClone.length > 0) {
        for (var i = 0; i < indentWidthClone.length; i++) {
          indentWidth += indentWidthClone[i].offsetWidth;
        }
      }

      var detailsElement = contentTable.querySelector('.e-detailrowcollapse') || contentTable.querySelector('.e-detailrowexpand');

      if (this.parent.options.hasDetailTemplate && detailsElement) {
        indentWidth += detailsElement.offsetWidth;
      }

      var headerText = [headerTextClone];
      var contentText = [];
      var footerText = [];

      if (footerTable) {
        for (var i = 0; i < footerTextClone.length; i++) {
          footerText[i] = footerTextClone[i].cloneNode(true);
        }
      }

      for (var i = 0; i < contentTextClone.length; i++) {
        contentText[i] = contentTextClone[i].cloneNode(true);
      }

      var wHeader = this.createTable(headerTable, headerText, headerDivTag);
      var wContent = this.createTable(contentTable, contentText, contentDivTag);
      var wFooter = null;

      if (footerText.length) {
        wFooter = this.createTable(footerTable, footerText, footerDivTag);
      }

      var columnbyindex = gObj.getColumns()[columnIndexByField];
      var result;
      var width = columnbyindex.width = sf.base.formatUnit(Math.max(wHeader, wContent, wFooter));
      this.widthService.setColumnWidth(gObj.getColumns()[columnIndexByField]);
      result = gObj.getColumns().some(function (x) {
        return x.width === null || x.width === undefined || x.width.length <= 0;
      });

      if (result === false) {
        var element = gObj.getColumns();

        for (var i = 0; i < element.length; i++) {
          if (element[i].visible) {
            tWidth = tWidth + parseFloat(element[i].width);
          }
        }
      }

      var calcTableWidth = tWidth + indentWidth;

      if (tWidth > 0 && !gObj.options.frozenColumns) {
        //TODO: why this?
        // if (this.parent.options.hasDetailTemplate) {
        //     this.widthService.setColumnWidth(new Column({ width: '30px' }));
        // }
        headerTable.style.width = sf.base.formatUnit(calcTableWidth);
        contentTable.style.width = sf.base.formatUnit(calcTableWidth);

        if (!sf.base.isNullOrUndefined(footerTable)) {
          footerTable.style.width = sf.base.formatUnit(calcTableWidth);
        }
      }

      var tableWidth = headerTable.offsetWidth;
      var contentwidth = gObj.getContent().scrollWidth;

      if (contentwidth > tableWidth) {
        headerTable.classList.add('e-tableborder');
        contentTable.classList.add('e-tableborder');
      } else {
        headerTable.classList.remove('e-tableborder');
        contentTable.classList.remove('e-tableborder');
      }

      if (!sf.base.isNullOrUndefined(footerTable)) {
        footerTable.classList.add('e-tableborder');
      }

      this.parent.freezeModule.refreshRowHeight();
      this.parent.dotNetRef.invokeMethodAsync("ColumnWidthChanged", {
        width: width,
        columnUid: uid
      });
    };
    /**
     * To destroy the resize
     * @return {void}
     * @hidden
     */


    Resize.prototype.destroy = function () {
      var gridElement = this.parent.element;

      if (!gridElement || !gridElement.querySelector('.e-gridheader') && !gridElement.querySelector('.e-gridcontent')) {
        return;
      }

      this.widthService = null;
      this.unwireEvents(); //this.removeEventListener();
    };
    /**
     * For internal use only - Get the module name.
     * @private
     */


    Resize.prototype.getModuleName = function () {
      return 'resize';
    };

    Resize.prototype.findColumn = function (fName) {
      for (var i = 0; i < fName.length; i++) {
        var fieldName = fName[i];
        var columnIndex = this.parent.getColumnIndexByField(fieldName);

        if (this.parent.getColumns()[columnIndex].visible === true) {
          this.resizeColumn(fieldName, columnIndex);
        }
      }
    };
    /**
     * To create table for autofit
     * @hidden
     */


    Resize.prototype.createTable = function (table, text, tag) {
      var myTableDiv = sf.base.createElement('div');
      myTableDiv.className = this.parent.element.className;
      myTableDiv.style.cssText = 'display: inline-block;visibility:hidden;position:absolute';
      var mySubDiv = sf.base.createElement('div');
      mySubDiv.className = tag;
      var myTable = sf.base.createElement('table');
      myTable.className = table.className;
      myTable.classList.add('e-resizetable');
      myTable.style.cssText = 'table-layout: auto;width: auto';
      var myTr = sf.base.createElement('tr');

      for (var i = 0; i < text.length; i++) {
        var tr = myTr.cloneNode();
        tr.className = table.querySelector('tr').className;
        tr.appendChild(text[i]);
        myTable.appendChild(tr);
      }

      mySubDiv.appendChild(myTable);
      myTableDiv.appendChild(mySubDiv);
      document.body.appendChild(myTableDiv);
      var offsetWidthValue = myTable.getBoundingClientRect().width;
      document.body.removeChild(myTableDiv);
      return Math.ceil(offsetWidthValue);
    };
    /**
     * @hidden
     */
    // public addEventListener(): void {
    //     if (this.parent.isDestroyed) {
    //         return;
    //     }
    //     this.parent.on(events.headerRefreshed, this.refreshHeight, this);
    //     this.parent.on(events.initialEnd, this.wireEvents, this);
    //     this.parent.on(events.contentReady, this.autoFit, this);
    // }

    /**
     * @hidden
     */
    // public removeEventListener(): void {
    //     if (this.parent.isDestroyed) {
    //         return;
    //     }
    //     this.parent.off(events.headerRefreshed, this.refreshHeight);
    //     this.parent.off(events.initialEnd, this.wireEvents);
    // }

    /**
     * @hidden
     */


    Resize.prototype.render = function () {
      this.unwireEvents();
      this.wireEvents();
      this.setHandlerHeight();
    };

    Resize.prototype.refreshHeight = function () {
      var element = this.getResizeHandlers();

      for (var i = 0; i < element.length; i++) {
        if (element[i].parentElement.offsetHeight > 0) {
          element[i].style.height = element[i].parentElement.offsetHeight + 'px';
        }
      }

      this.setHandlerHeight();
    };

    Resize.prototype.wireEvents = function () {
      sf.base.EventHandler.add(this.parent.getHeaderContent(), sf.base.Browser.touchStartEvent, this.resizeStart, this);
      sf.base.EventHandler.add(this.parent.getHeaderContent(), 'dblclick', this.callAutoFit, this);
    };

    Resize.prototype.unwireEvents = function () {
      sf.base.EventHandler.remove(this.parent.getHeaderContent(), sf.base.Browser.touchStartEvent, this.resizeStart);
      sf.base.EventHandler.remove(this.parent.getHeaderContent(), 'dblclick', this.callAutoFit);
    };

    Resize.prototype.getResizeHandlers = function () {
      return this.parent.options.frozenColumns ? [].slice.call(this.parent.getHeaderContent().querySelectorAll('.' + resizeClassList.root)) : [].slice.call(this.parent.getHeaderContent().querySelector(".e-table").querySelectorAll('.' + resizeClassList.root));
    };

    Resize.prototype.setHandlerHeight = function () {
      var element = [].slice.call(this.parent.getHeaderContent().querySelector(".e-table").querySelectorAll('.' + resizeClassList.suppress));

      for (var i = 0; i < element.length; i++) {
        element[i].style.height = element[i].parentElement.offsetHeight + 'px';
      }
    };

    Resize.prototype.callAutoFit = function (e) {
      if (e.target.classList.contains('e-rhandler')) {
        var col = this.getTargetColumn(e);

        if (col.columns) {
          return;
        }

        this.resizeColumn(col.field, this.parent.getNormalizedColumnIndex(col.uid), col.uid);
        var header = sf.base.closest(e.target, resizeClassList.header);
        header.classList.add('e-resized');
      }
    };

    Resize.prototype.resizeStart = function (e) {
      if (e.target.classList.contains('e-rhandler')) {
        if (!this.helper) {
          if (this.getScrollBarWidth() === 0) {
            for (var _i = 0, _a = this.refreshColumnWidth(); _i < _a.length; _i++) {
              var col = _a[_i];
              this.widthService.setColumnWidth(col);
            }

            this.widthService.setWidthToTable();
          }

          this.refreshStackedColumnWidth();
          this.element = e.target; //TODO: rowheight
          // if (this.parent.getVisibleFrozenColumns()) {
          //     let mtbody: Element = this.parent.getContent().querySelector('.e-movablecontent').querySelector('tbody');
          //     let ftbody: Element = this.parent.getContent().querySelector('.e-frozencontent').querySelector('tbody');
          //     let mtr: NodeListOf<HTMLElement> = mtbody.querySelectorAll('tr');
          //     let ftr: NodeListOf<HTMLElement> = ftbody.querySelectorAll('tr');
          //     for (let i: number = 0; i < mtr.length; i++) {
          //         if (this.parent.rowHeight) {
          //             mtr[i].style.height = this.parent.rowHeight + 'px';
          //             ftr[i].style.height = this.parent.rowHeight + 'px';
          //         } else {
          //             mtr[i].style.removeProperty('height');
          //             ftr[i].style.removeProperty('height');
          //         }
          //     }
          // }

          this.parentElementWidth = this.parent.element.getBoundingClientRect().width;
          this.appendHelper();
          this.column = this.getTargetColumn(e);
          this.pageX = this.getPointX(e);

          if (this.parent.options.enableRtl) {
            this.minMove = parseFloat(this.column.width.toString()) - (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0);
          } else {
            this.minMove = (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0) - parseFloat(sf.base.isNullOrUndefined(this.column.width) ? '' : this.column.width.toString());
          }

          this.minMove += this.pageX;
        }

        if (sf.base.Browser.isDevice && !this.helper.classList.contains(resizeClassList.icon)) {
          this.helper.classList.add(resizeClassList.icon);
          sf.base.EventHandler.add(document, sf.base.Browser.touchStartEvent, this.removeHelper, this);
          sf.base.EventHandler.add(this.helper, sf.base.Browser.touchStartEvent, this.resizeStart, this);
        } else {
          // let args: ResizeArgs = {
          //     e: isBlazor() && !this.parent.isJsComponent ? null : e,
          //     column: this.column
          // };
          // this.parent.trigger(events.resizeStart, args, (args: ResizeArgs) => {
          //     if (args.cancel || this.parent.isEdit) {
          //         this.cancelResizeAction();
          //         return;
          //     }
          sf.base.EventHandler.add(document, sf.base.Browser.touchEndEvent, this.resizeEnd, this);
          sf.base.EventHandler.add(this.parent.element, sf.base.Browser.touchMoveEvent, this.resizing, this);
          this.updateCursor('add');
          this.parent.dotNetRef.invokeMethodAsync("ResizeStarted", {
            columnUid: this.column.uid
          }); // });
        }
      }
    };

    Resize.prototype.cancelResizeAction = function (removeEvents) {
      if (removeEvents) {
        sf.base.EventHandler.remove(this.parent.element, sf.base.Browser.touchMoveEvent, this.resizing);
        sf.base.EventHandler.remove(document, sf.base.Browser.touchEndEvent, this.resizeEnd);
        this.updateCursor('remove');
      }

      if (sf.base.Browser.isDevice) {
        sf.base.EventHandler.remove(document, sf.base.Browser.touchStartEvent, this.removeHelper);
        sf.base.EventHandler.remove(this.helper, sf.base.Browser.touchStartEvent, this.resizeStart);
      }

      sf.base.detach(this.helper);
      this.refresh();
    };

    Resize.prototype.getWidth = function (width, minWidth, maxWidth) {
      if (minWidth && width < minWidth) {
        return minWidth;
      } else if (maxWidth && width > maxWidth) {
        return maxWidth;
      } else {
        return width;
      }
    };

    Resize.prototype.updateResizeEleHeight = function () {
      var elements = [].slice.call(this.parent.getHeaderContent().querySelectorAll('.e-rhandler'));

      for (var i = 0; i < elements.length; i++) {
        elements[i].style.height = elements[i].parentElement.offsetHeight + 'px';
      }
    };

    Resize.prototype.getColData = function (column, mousemove) {
      return {
        width: parseFloat(sf.base.isNullOrUndefined(this.widthService.getWidth(column)) || this.widthService.getWidth(column) === 'auto' ? '0' : this.widthService.getWidth(column).toString()) + mousemove,
        minWidth: column.minWidth ? parseFloat(column.minWidth.toString()) : null,
        maxWidth: column.maxWidth ? parseFloat(column.maxWidth.toString()) : null
      };
    };

    Resize.prototype.resizing = function (e) {
      if (sf.base.isNullOrUndefined(this.column)) {
        return;
      }

      var offsetWidth = 0;

      if (sf.base.isNullOrUndefined(this.column)) {
        offsetWidth = parentsUntil(this.element, 'th').offsetWidth;
      }

      if (this.parent.options.allowTextWrap) {
        this.updateResizeEleHeight();
        this.setHelperHeight();
      }

      var pageX = this.getPointX(e);
      var mousemove = this.parent.options.enableRtl ? -(pageX - this.pageX) : pageX - this.pageX;
      var colData = this.getColData(this.column, mousemove);

      if (!colData.width) {
        colData.width = sf.base.closest(this.element, 'th').offsetWidth;
      }

      var width = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);

      if (!this.parent.options.enableRtl && this.minMove >= pageX || this.parent.options.enableRtl && this.minMove <= pageX) {
        width = this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0;
        this.pageX = pageX = this.minMove;
      }

      if (width !== parseFloat(sf.base.isNullOrUndefined(this.column.width) || this.column.width === 'auto' ? offsetWidth.toString() : this.column.width.toString())) {
        this.pageX = pageX;
        this.column.width = sf.base.formatUnit(width); // let args: ResizeArgs = {
        //     e: e,
        //     column: this.column
        // };
        //this.parent.trigger(events.onResize, args);
        // if (args.cancel) {
        //     this.cancelResizeAction(true);
        //     return;
        // }

        var columns = [this.column];
        var finalColumns = [this.column];

        if (this.column.columns) {
          columns = this.getSubColumns(this.column, []);
          columns = this.calulateColumnsWidth(columns, false, mousemove);
          finalColumns = this.calulateColumnsWidth(columns, true, mousemove);
        }

        for (var _i = 0, finalColumns_1 = finalColumns; _i < finalColumns_1.length; _i++) {
          var col = finalColumns_1[_i];
          this.widthService.setColumnWidth(col, null, 'resize');
        }

        this.updateHelper();
      }

      this.isDblClk = false;
    };

    Resize.prototype.calulateColumnsWidth = function (columns, isUpdate, mousemove) {
      var finalColumns = [];

      for (var _i = 0, columns_1 = columns; _i < columns_1.length; _i++) {
        var col = columns_1[_i];
        var totalWidth = 0;

        for (var i = 0; i < columns.length; i++) {
          totalWidth += parseFloat(columns[i].width.toString());
        }

        var colData = this.getColData(col, parseFloat(col.width) * mousemove / totalWidth);
        var colWidth = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);

        if (colWidth !== parseFloat(col.width.toString())) {
          if (isUpdate) {
            col.width = sf.base.formatUnit(colWidth < 1 ? 1 : colWidth);
          }

          finalColumns.push(col);
        }
      }

      return finalColumns;
    };

    Resize.prototype.getSubColumns = function (column, subColumns) {
      for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {
        var col = _a[_i];

        if (col.visible !== false && col.allowResizing) {
          if (col.columns) {
            this.getSubColumns(col, subColumns);
          } else {
            subColumns.push(col);
          }
        }
      }

      return subColumns;
    };

    Resize.prototype.resizeEnd = function (e) {
      if (!this.helper) {
        return;
      }

      sf.base.EventHandler.remove(this.parent.element, sf.base.Browser.touchMoveEvent, this.resizing);
      sf.base.EventHandler.remove(document, sf.base.Browser.touchEndEvent, this.resizeEnd);
      this.updateCursor('remove');
      sf.base.detach(this.helper); // let args: ResizeArgs = {
      //     e: isBlazor() && !this.parent.isJsComponent ? null : e,
      //     column: this.column
      // };

      var content = this.parent.getContent(); // let cTable: HTMLElement = content.querySelector('.e-movablecontent') ? content.querySelector('.e-movablecontent') : content;
      // if (cTable.scrollHeight >= cTable.clientHeight) {
      //     this.parent.scrollModule.setPadding();
      //     cTable.style.overflowY = 'scroll';
      // }
      //this.parent.trigger(events.resizeStop, args);

      sf.base.closest(this.element, '.e-headercell').classList.add('e-resized');

      if (parentsUntil(this.element, 'e-frozenheader')) {
        this.isFrozenColResized = true;
      } else {
        this.isFrozenColResized = false;
      }

      if (this.parent.options.frozenColumns) {
        this.parent.freezeModule.refreshRowHeight();
      }

      if (this.parent.options.allowTextWrap) {
        this.updateResizeEleHeight();
      }

      var width = this.column.width.toString();
      width = width.replace("px", "");
      this.parent.dotNetRef.invokeMethodAsync("ColumnWidthChanged", {
        width: width,
        columnUid: this.column.uid
      });
      this.refresh();
      this.doubleTapEvent(e);
      this.isDblClk = true;
    };

    Resize.prototype.getPointX = function (e) {
      if (e.touches && e.touches.length) {
        return e.touches[0].pageX;
      } else {
        return e.pageX;
      }
    };

    Resize.prototype.refreshColumnWidth = function () {
      var columns = this.parent.getColumns();

      for (var _i = 0, _a = [].slice.apply(this.parent.getHeaderContent().querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {
        var ele = _a[_i];

        for (var _b = 0, columns_2 = columns; _b < columns_2.length; _b++) {
          var column = columns_2[_b];

          if (ele.querySelector('[e-mappinguid]') && ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === column.uid && column.visible) {
            column.width = ele.getBoundingClientRect().width;
            break;
          }
        }
      }

      return columns;
    };

    Resize.prototype.refreshStackedColumnWidth = function () {
      for (var _i = 0, _a = this.parent.getStackedColumns(this.parent.options.columns); _i < _a.length; _i++) {
        var stackedColumn = _a[_i];
        stackedColumn.width = this.getStackedWidth(stackedColumn, 0);
      }
    };

    Resize.prototype.getStackedWidth = function (column, width) {
      for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {
        var col = _a[_i];

        if (col.visible !== false) {
          if (col.columns) {
            this.getStackedWidth(col, width);
          } else {
            width += col.width;
          }
        }
      }

      return width;
    };

    Resize.prototype.getTargetColumn = function (e) {
      var cell = sf.base.closest(e.target, resizeClassList.header);
      cell = cell.querySelector('.e-headercelldiv') || cell.querySelector('.e-stackedheadercelldiv');
      var uid = cell.getAttribute('e-mappinguid');
      return this.parent.getColumnByUid(uid);
    };

    Resize.prototype.updateCursor = function (action) {
      var headerRows = [].slice.call(this.parent.getHeaderContent().querySelectorAll('th'));
      headerRows.push(this.parent.element);

      for (var _i = 0, headerRows_1 = headerRows; _i < headerRows_1.length; _i++) {
        var row = headerRows_1[_i];
        row.classList[action](resizeClassList.cursor);
      }
    };

    Resize.prototype.refresh = function () {
      this.column = null;
      this.pageX = null;
      this.element = null;
      this.helper = null;
    };

    Resize.prototype.appendHelper = function () {
      this.helper = sf.base.createElement('div', {
        className: resizeClassList.helper
      });
      this.parent.element.appendChild(this.helper);
      this.setHelperHeight();
    };

    Resize.prototype.setHelperHeight = function () {
      var height = this.parent.getContent().offsetHeight - this.getScrollBarWidth();
      var rect = sf.base.closest(this.element, resizeClassList.header);
      var tr = [].slice.call(this.parent.getHeaderContent().querySelectorAll('tr'));
      var frzCols = this.parent.options.frozenColumns;

      if (frzCols) {
        if (rect.parentElement.children.length !== frzCols) {
          tr.splice(0, tr.length / 2);
        } else {
          tr.splice(tr.length / 2, tr.length / 2);
        }
      }

      for (var i = tr.indexOf(rect.parentElement); i < tr.length; i++) {
        height += tr[i].offsetHeight;
      }

      var pos = this.calcPos(rect);
      pos.left += this.parent.options.enableRtl ? 0 - 1 : rect.offsetWidth - 2;
      this.helper.style.cssText = 'height: ' + height + 'px; top: ' + pos.top + 'px; left:' + Math.floor(pos.left) + 'px;';
    };

    Resize.prototype.getScrollBarWidth = function (height) {
      var ele = this.parent.options.frozenColumns ? this.parent.getContent().querySelector('.e-movablecontent') : this.parent.getContent();
      return ele.scrollHeight > ele.clientHeight && height || ele.scrollWidth > ele.clientWidth ? getScrollBarWidth() : 0;
    };

    Resize.prototype.removeHelper = function (e) {
      var cls = e.target.classList;

      if (!(cls.contains(resizeClassList.root) || cls.contains(resizeClassList.icon)) && this.helper) {
        sf.base.EventHandler.remove(document, sf.base.Browser.touchStartEvent, this.removeHelper);
        sf.base.EventHandler.remove(this.helper, sf.base.Browser.touchStartEvent, this.resizeStart);
        sf.base.detach(this.helper);
        this.refresh();
      }
    };

    Resize.prototype.updateHelper = function () {
      var rect = sf.base.closest(this.element, resizeClassList.header);
      var left = Math.floor(this.calcPos(rect).left + (this.parent.options.enableRtl ? 0 - 1 : rect.offsetWidth - 2));
      var borderWidth = 2; // to maintain the helper inside of grid element.

      if (left > this.parentElementWidth) {
        left = this.parentElementWidth - borderWidth;
      }

      if (this.parent.options.frozenColumns) {
        var table = sf.base.closest(rect, '.e-table');
        var fLeft = table.offsetLeft;

        if (left < fLeft) {
          left = fLeft;
        }
      }

      this.helper.style.left = left + 'px';
    };

    Resize.prototype.calcPos = function (elem) {
      var parentOffset = {
        top: 0,
        left: 0
      };
      var offset = elem.getBoundingClientRect();
      var doc = elem.ownerDocument;
      var offsetParent = elem.offsetParent || doc.documentElement;

      while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {
        offsetParent = offsetParent.parentNode;
      }

      if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {
        parentOffset = offsetParent.getBoundingClientRect();
      }

      return {
        top: offset.top - parentOffset.top,
        left: offset.left - parentOffset.left
      };
    };

    Resize.prototype.doubleTapEvent = function (e) {
      if (this.getUserAgent() && this.isDblClk) {
        if (!this.tapped) {
          this.tapped = setTimeout(this.timeoutHandler(), 300);
        } else {
          clearTimeout(this.tapped);
          this.callAutoFit(e);
          this.tapped = null;
        }
      }
    };

    Resize.prototype.getUserAgent = function () {
      var userAgent = sf.base.Browser.userAgent.toLowerCase();
      return /iphone|ipod|ipad/.test(userAgent);
    };

    Resize.prototype.timeoutHandler = function () {
      this.tapped = null;
    };

    return Resize;
  }();
  /**
   *
   * The `Group` module is used to handle group action.
   */


  var Group =
  /** @class */
  function () {
    /**
     * Constructor for Grid group module
     * @hidden
     */
    function Group(parent) {
      var _this = this;

      this.visualElement = sf.base.createElement('div', {
        className: 'e-cloneproperties e-dragclone e-gdclone',
        styles: 'line-height:23px',
        attrs: {
          action: 'grouping'
        }
      });

      this.helper = function (e) {
        var gObj = _this.parent;
        var target = e.sender.target;
        var element = target.classList.contains('e-groupheadercell') ? target : parentsUntil(target, 'e-groupheadercell');

        if (!element || !target.classList.contains('e-drag') && _this.parent.options.groupReordering) {
          return false;
        }

        _this.column = gObj.getColumnByField(element.firstElementChild.getAttribute('ej-mappingname'));
        _this.visualElement.textContent = element.textContent;
        _this.visualElement.style.width = element.offsetWidth + 2 + 'px';
        _this.visualElement.style.height = element.offsetHeight + 2 + 'px';

        _this.visualElement.setAttribute('e-mappinguid', _this.column.uid);

        gObj.element.appendChild(_this.visualElement);
        return _this.visualElement;
      };

      this.dragStart = function (e) {
        _this.parent.element.classList.add('e-ungroupdrag');

        e.bindEvents(e.dragElement);
      };

      this.drag = function (e) {
        // if (this.groupSettings.allowReordering) {
        //     this.animateDropper(e);
        // }
        var target = e.target;

        var cloneElement = _this.parent.element.querySelector('.e-cloneproperties'); // this.parent.trigger(events.columnDrag, { target: target, draggableType: 'headercell', column: this.column });


        if (!_this.parent.options.groupReordering) {
          sf.base.classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);

          if (!(parentsUntil(target, 'e-gridcontent') || parentsUntil(target, 'e-headercell'))) {
            sf.base.classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);
          }
        }
      };

      this.dragStop = function (e) {
        _this.parent.element.classList.remove('e-ungroupdrag');

        var preventDrop = !(parentsUntil(e.target, 'e-gridcontent') || parentsUntil(e.target, 'e-gridheader')); // if (this.groupSettings.allowReordering && preventDrop) {     //TODO: reordering
        //     remove(e.helper);
        //     if (parentsUntil(e.target, 'e-groupdroparea')) {
        //         this.rearrangeGroup(e);
        //     } else if (!(parentsUntil(e.target, 'e-grid'))) {
        //         let field: string = this.parent.getColumnByUid(e.helper.getAttribute('e-mappinguid')).field;
        //         if (this.groupSettings.columns.indexOf(field) !== -1) {
        //             this.ungroupColumn(field);
        //         }
        //     }
        //     return;
        // } else

        if (preventDrop) {
          sf.base.remove(e.helper);
          return;
        }
      }; //TODO: reordering
      // private animateDropper: Function = (e: { target: HTMLElement, event: MouseEventArgs, helper: Element }) => {
      //     let uid: string = this.parent.element.querySelector('.e-cloneproperties').getAttribute('e-mappinguid');
      //     let dragField: string = this.parent.getColumnByUid(uid).field;
      //     let parent: Element = parentsUntil(e.target, 'e-groupdroparea');
      //     let dropTarget: Element = parentsUntil(e.target, 'e-group-animator');
      //     // tslint:disable-next-line
      //     let grouped: string[] = [].slice.call(this.element.querySelectorAll('.e-groupheadercell'))
      //         .map((e: Element) => e.querySelector('div').getAttribute('ej-mappingname'));
      //     let cols: string[] = JSON.parse(JSON.stringify(grouped));
      //     if (dropTarget || parent) {
      //         if (dropTarget) {
      //             let dropField: string = dropTarget.querySelector('div[ej-mappingname]').getAttribute('ej-mappingname');
      //             let dropIndex: number = +(dropTarget.getAttribute('index'));
      //             if (dropField !== dragField) {
      //                 let dragIndex: number = cols.indexOf(dragField);
      //                 if (dragIndex !== -1) {
      //                     cols.splice(dragIndex, 1);
      //                 }
      //                 let flag: boolean = dropIndex !== -1 && dragIndex === dropIndex;
      //                 cols.splice(dropIndex + (flag ? 1 : 0), 0, dragField);
      //             }
      //         } else if (parent && cols.indexOf(dragField) === -1) {
      //             cols.push(dragField);
      //         }
      //         this.element.innerHTML = '';
      //         if (cols.length && !this.element.classList.contains('e-grouped')) {
      //             this.element.classList.add('e-grouped');
      //         }
      //         this.reorderingColumns = cols;
      //         for (let c: number = 0; c < cols.length; c++) {
      //             this.addColToGroupDrop(cols[c]);
      //         }
      //     } else {
      //         this.addLabel();
      //         this.removeColFromGroupDrop(dragField);
      //     }
      // }
      // private rearrangeGroup(e: { target: HTMLElement, event: MouseEventArgs, helper: Element }): void {
      //     this.sortRequired = false;
      //     this.updateModel();
      // }


      this.drop = function (e) {
        var gObj = _this.parent;
        var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));
        gObj.element.querySelector('.e-groupdroparea').classList.remove('e-hover');
        sf.base.remove(e.droppedElement);

        _this.parent.element.querySelector('.e-groupdroparea').removeAttribute("aria-dropeffect");

        _this.parent.element.querySelector('[aria-grabbed=true]').setAttribute("aria-grabbed", 'false');

        if (sf.base.isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {
          return;
        }

        gObj.dotNetRef.invokeMethodAsync("GroupColumn", column.field, 'Group');
      };

      this.parent = parent;

      if (this.parent.options.allowGrouping) {
        this.initDragAndDrop();
      }
    }

    Group.prototype.columnDrag = function (e) {
      if (this.parent.options.groupReordering) {// this.animateDropper(e);
      }

      var gObj = this.parent;
      var cloneElement = this.parent.element.querySelector('.e-cloneproperties');
      sf.base.classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);

      if (!parentsUntil(e.target, 'e-groupdroparea') && !(this.parent.options.groupReordering && parentsUntil(e.target, 'e-headercell'))) {
        sf.base.classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);
      }

      e.target.classList.contains('e-groupdroparea') ? gObj.element.querySelector('.e-groupdroparea').classList.add('e-hover') : gObj.element.querySelector('.e-groupdroparea').classList.remove('e-hover');
    };

    Group.prototype.columnDragStart = function (e) {
      if (e.target.classList.contains('e-stackedheadercell')) {
        return;
      }

      var dropArea = this.parent.element.querySelector('.e-groupdroparea');

      if (dropArea) {
        dropArea.setAttribute("aria-dropeffect", "copy");
      }

      var element = e.target.classList.contains('e-headercell') ? e.target : parentsUntil(e.target, 'e-headercell');
      element.setAttribute("aria-grabbed", 'true');
    };

    Group.prototype.columnDrop = function (e) {
      var gObj = this.parent;

      if (e.droppedElement.getAttribute('action') === 'grouping') {
        var column = gObj.getColumnByUid(e.droppedElement.getAttribute('e-mappinguid'));

        if (sf.base.isNullOrUndefined(column) || column.allowGrouping === false || parentsUntil(gObj.getColumnHeaderByUid(column.uid), 'e-grid').getAttribute('id') !== gObj.element.getAttribute('id')) {
          return;
        }

        gObj.dotNetRef.invokeMethodAsync("GroupColumn", column.field, 'Ungroup');
      }
    }; // private keyPressHandler(e: KeyboardEventArgs): void {
    //     let gObj: SfGrid = this.parent;
    //     if (e.action !== 'ctrlSpace' && (!this.groupSettings.columns.length ||
    //         ['altDownArrow', 'altUpArrow', 'ctrlDownArrow', 'ctrlUpArrow', 'enter'].indexOf(e.action) === -1)) {
    //         return;
    //     }
    //     e.preventDefault();
    //     switch (e.action) {
    //         case 'altDownArrow':
    //         case 'altUpArrow':
    //             let selected: number[] = gObj.allowSelection ? gObj.getSelectedRowIndexes() : [];
    //             if (selected.length) {
    //                 let rows: HTMLCollection = gObj.getContentTable().querySelector('tbody').children;
    //                 let dataRow: HTMLTableRowElement = gObj.getDataRows()[selected[selected.length - 1]] as HTMLTableRowElement;
    //                 let grpRow: Element;
    //                 for (let i: number = dataRow.rowIndex; i >= 0; i--) {
    //                     if (!rows[i].classList.contains('e-row') && !rows[i].classList.contains('e-detailrow')) {
    //                         grpRow = rows[i];
    //                         break;
    //                     }
    //                 }
    //                 this.expandCollapseRows(grpRow.querySelector(e.action === 'altUpArrow' ?
    //                     '.e-recordplusexpand' : '.e-recordpluscollapse'));
    //             }
    //             break;
    //         case 'ctrlDownArrow':
    //             this.expandAll();
    //             break;
    //         case 'ctrlUpArrow':
    //             this.collapseAll();
    //             break;
    //         case 'enter':
    //             if (this.parent.isEdit || (closest(e.target as Element, '#' + this.parent.element.id + '_searchbar') !== null)) { return; }
    //             let element: HTMLElement = this.focus.getFocusedElement();
    //             let row: Element = element ? element.parentElement.querySelector('[class^="e-record"]') : null;
    //             if (!row) { break; }
    //             this.expandCollapseRows(row);
    //             break;
    //         case 'ctrlSpace':
    //             let elem: HTMLElement = gObj.focusModule.currentInfo.element;
    //             if (elem && elem.classList.contains('e-headercell')) {
    //                 let column: Column = gObj.getColumnByUid(elem.firstElementChild.getAttribute('e-mappinguid'));
    //                 column.field && gObj.groupSettings.columns.indexOf(column.field) < 0 ?
    //                     this.groupColumn(column.field) : this.ungroupColumn(column.field);
    //             }
    //             break;
    //     }
    // }


    Group.prototype.initDragAndDrop = function () {
      this.initializeGHeaderDrop();
      this.initializeGHeaderDrag();
    };

    Group.prototype.initializeGHeaderDrag = function () {
      var ele = this.parent.element.querySelector('.e-groupdroparea');

      if (!ele) {
        return;
      }

      var drag = new sf.base.Draggable(ele, {
        dragTarget: this.parent.options.groupReordering ? '.e-drag' : '.e-groupheadercell',
        distance: this.parent.options.groupReordering ? -10 : 5,
        helper: this.helper,
        dragStart: this.dragStart,
        drag: this.drag,
        dragStop: this.dragStop
      });
    };

    Group.prototype.initializeGHeaderDrop = function () {
      var gObj = this.parent;
      var ele = this.parent.element.querySelector('.e-groupdroparea');

      if (!ele) {
        return;
      }

      var drop = new sf.base.Droppable(ele, {
        accept: '.e-dragclone',
        drop: this.drop
      });
    };
    /**
     * For internal use only - Get the module name.
     * @private
     */


    Group.prototype.getModuleName = function () {
      return 'group';
    };

    Group.prototype.getGHeaderCell = function (field) {
      if (this.element && this.element.querySelector('[ej-mappingname="' + field + '"]')) {
        return this.element.querySelector('[ej-mappingname="' + field + '"]').parentElement;
      }

      return null;
    };

    return Group;
  }();
  /**
   * The `ColumnChooser` module is used to show or hide columns dynamically.
   */


  var ColumnChooser =
  /** @class */
  function () {
    function ColumnChooser(parent) {
      this.parent = parent;
    }
    /**
     * Get columnChooser Position.
     * @return {void}
     * @hidden
     */


    ColumnChooser.prototype.renderColumnChooser = function () {
      var dlgelement = this.parent.element.querySelector("#" + this.parent.element.id + "_ccdlg");
      dlgelement.style.maxHeight = '430px';
      var elementVisible = dlgelement.style.display;
      dlgelement.style.display = 'block';
      var newpos = sf.popups.calculateRelativeBasedPosition(this.parent.element.querySelector(".e-cc-toolbar"), dlgelement);
      dlgelement.style.display = elementVisible;
      var top = newpos.top + this.parent.element.querySelector(".e-cc-toolbar").getBoundingClientRect().height;
      var dlgWidth = 250;
      var left;

      if (this.parent.options.enableRtl) {
        left = this.parent.element.querySelector(".e-columnchooser-btn").offsetLeft;
      } else {
        left = newpos.left - dlgWidth + this.parent.element.querySelector(".e-cc-toolbar").clientWidth + 2;
      }

      this.parent.dotNetRef.invokeMethodAsync("GetChooserPosition", left.toString(), top.toString());
    };

    return ColumnChooser;
  }();
  /**
   * The `ColumnMenu` module is used to show or hide columns dynamically.
   */


  var ColumnMenu =
  /** @class */
  function () {
    function ColumnMenu(parent) {
      this.parent = parent;
    }
    /**
     * Get columnMenu Position.
     * @return {void}
     * @hidden
     */


    ColumnMenu.prototype.renderColumnMenu = function (uid) {
      var e = this.parent.getColumnHeaderByUid(uid).querySelector('.e-columnmenu');
      var element = document.querySelector("#" + this.parent.element.id + "_columnmenu");
      var pos = {
        top: 0,
        left: 0
      };
      element.style.cssText = 'display:block;visibility:hidden';
      var elePos = element.getBoundingClientRect();
      element.style.cssText = 'display:none;visibility:visible';
      var headerCell = this.getHeaderCell(e);

      if (sf.base.Browser.isDevice) {
        pos.top = window.innerHeight / 2 - elePos.height / 2;
        pos.left = window.innerWidth / 2 - elePos.width / 2;
      } else {
        if (this.parent.options.enableRtl) {
          pos = sf.popups.calculatePosition(headerCell, 'left', 'bottom');
        } else {
          pos = sf.popups.calculatePosition(headerCell, 'right', 'bottom');
          pos.left -= elePos.width;
        }
      }

      this.parent.dotNetRef.invokeMethodAsync("GetColumnMenuPosition", pos.left.toString(), pos.top.toString());
    };

    ColumnMenu.prototype.getHeaderCell = function (e) {
      return sf.base.closest(e, 'th.e-headercell');
    };

    return ColumnMenu;
  }();
  /**
   * Editing
   */


  var Edit =
  /** @class */
  function () {
    function Edit(parent) {
      this.parent = parent;
    }

    Edit.prototype.createTooltip = function (results, isAdd) {
      var toolTipPos = {};

      for (var i = 0; i < results.length; i++) {
        var gcontent = this.parent.getContent().firstElementChild;

        if (this.parent.options.frozenColumns) {
          gcontent = this.parent.getContent().querySelector('.e-movablecontent');
        }

        var name_1 = results[i]['fieldName'];
        var message = results[i]['message'];
        var element = this.parent.element.querySelector("#" + name_1) || document.querySelector("#" + name_1);
        var isScroll = gcontent.scrollHeight > gcontent.clientHeight || gcontent.scrollWidth > gcontent.clientWidth;
        var isInline = this.parent.options.editMode !== 'Dialog';
        var td = sf.base.closest(element, '.e-rowcell');
        var row = sf.base.closest(element, '.e-row');
        var fCont = this.parent.getContent().querySelector('.e-frozencontent');
        var isFHdr = void 0;
        var isFHdrLastRow = false;
        var validationForBottomRowPos = void 0;
        var isBatchModeLastRow = false; // TODO: Batch
        //  let viewPortRowCount: number = Math.round(this.parent.getContent().clientHeight / this.parent.getRowHeight()) - 1;
        // let rows: Element[] = !fCont ? [].slice.call(this.parent.getContent().querySelectorAll('.e-row'))
        //   : [].slice.call(this.parent.getFrozenVirtualContent().querySelectorAll('.e-row'));
        // if (this.parent.options.mode === 'Batch') {
        //     if (viewPortRowCount > 1 && rows.length >= viewPortRowCount
        //         && rows[rows.length - 1].getAttribute('aria-rowindex') === row.getAttribute('aria-rowindex')) {
        //         isBatchModeLastRow = true;
        //     }
        // }

        if (isInline) {
          if (this.parent.options.frozenRows) {// TODO: FrozenRows
            // let fHeraderRows: HTMLCollection = this.parent.getFrozenColumns() ?
            //     this.parent.getFrozenVirtualHeader().querySelector('tbody').children
            //     : this.parent.getHeaderTable().querySelector('tbody').children;
            // isFHdr = fHeraderRows.length > (parseInt(row.getAttribute('aria-rowindex'), 10) || 0);
            // isFHdrLastRow = isFHdr && parseInt(row.getAttribute('aria-rowindex'), 10) === fHeraderRows.length - 1;
          }

          if (isFHdrLastRow || //viewPortRowCount > 1 && rows.length >= viewPortRowCount
          this.parent.options.newRowPosition === 'Bottom' && isAdd || !sf.base.isNullOrUndefined(td) && td.classList.contains('e-lastrowcell') && !row.classList.contains('e-addedrow') || isBatchModeLastRow) {
            validationForBottomRowPos = true;
          }
        }

        var table = isInline ? isFHdr ? this.parent.getHeaderTable() : this.parent.getContentTable() : document.querySelector('#' + this.parent.element.id + '_dialogEdit_wrapper').querySelector('.e-dlg-content');
        var client = table.getBoundingClientRect();
        var left = isInline ? this.parent.element.getBoundingClientRect().left : client.left;
        var input = sf.base.closest(element, 'td');
        var inputClient = input ? input.getBoundingClientRect() : element.parentElement.getBoundingClientRect();
        var div = this.parent.element.querySelector("#" + name_1 + "_Error") || document.querySelector("#" + name_1 + "_Error");
        div.style.top = (isFHdr ? inputClient.top + inputClient.height : inputClient.bottom - client.top - (this.parent.options.frozenColumns ? fCont.scrollTop : 0)) + table.scrollTop + 9 + 'px';
        div.style.left = inputClient.left - left + table.scrollLeft + inputClient.width / 2 + 'px';
        div.style.maxWidth = inputClient.width + 'px';

        if (isInline && client.left < left) {
          div.style.left = parseInt(div.style.left, 10) - client.left + left + 'px';
        }

        var arrow = void 0;

        if (validationForBottomRowPos) {
          arrow = div.querySelector('.e-tip-bottom');
        } else {
          arrow = div.querySelector('.e-tip-top');
        }

        if ((this.parent.options.frozenColumns || this.parent.options.frozenRows) && this.parent.options.editMode !== 'Dialog') {
          var getEditCell = this.parent.options.editMode === 'Normal' ? sf.base.closest(element, '.e-editcell') : sf.base.closest(element, '.e-table');
          div.style.position = 'absolute';
        }

        div.style.display = "block";
        div.querySelector(".e-error").innerText = message;

        if (!validationForBottomRowPos && isInline && gcontent.getBoundingClientRect().bottom < inputClient.bottom + inputClient.height) {
          gcontent.scrollTop = gcontent.scrollTop + div.offsetHeight + arrow.scrollHeight;
        }

        var lineHeight = parseInt(document.defaultView.getComputedStyle(div, null).getPropertyValue('font-size'), 10);

        if (div.getBoundingClientRect().width < inputClient.width && div.querySelector('label').getBoundingClientRect().height / (lineHeight * 1.2) >= 2) {
          div.style.width = div.style.maxWidth;
        }

        if ((this.parent.options.frozenColumns || this.parent.options.frozenRows) && (this.parent.options.editMode === 'Normal' || this.parent.options.editMode === 'Batch')) {
          div.style.left = input.offsetLeft + (input.offsetWidth / 2 - div.offsetWidth / 2) + 'px';
        } else {
          div.style.left = parseInt(div.style.left, 10) - div.offsetWidth / 2 + 'px';
        }

        if (isInline && !isScroll && !this.parent.options.allowPaging || this.parent.options.frozenColumns || this.parent.options.frozenRows) {
          gcontent.style.position = 'static';
          var pos = sf.popups.calculateRelativeBasedPosition(input, div);
          div.style.top = pos.top + inputClient.height + 9 + 'px';
        }

        if (validationForBottomRowPos) {
          if (isScroll && !this.parent.options.frozenColumns && this.parent.options.height !== 'auto' && !this.parent.options.frozenRows //&& !this.parent.enableVirtualization
          ) {
              var scrollWidth = gcontent.scrollWidth > gcontent.offsetWidth ? getScrollBarWidth() : 0;
              div.style.bottom = parseInt(this.parent.options.height) - gcontent.querySelector('table').offsetHeight - scrollWidth + inputClient.height + 9 + 'px';
            } else {
            div.style.bottom = inputClient.height + 9 + 'px';
          } //TODO: NEW LINES ADDED SHOULD CHECK
          // if (rows.length < viewPortRowCount && this.parent.editSettings.newRowPosition === 'Bottom' && (this.editModule.args
          //     && this.editModule.args.requestType === 'add')) {
          //     let rowsCount: number = this.parent.frozenRows ? this.parent.frozenRows + (rows.length - 1) : rows.length - 1;
          //     let rowsHeight: number = rowsCount * this.parent.getRowHeight();
          //     let position: number = this.parent.getContent().clientHeight - rowsHeight;
          //     div.style.bottom = position + 9 + 'px';
          // }


          div.style.top = null;
        }

        toolTipPos[name_1] = "top: " + div.style.top + "; bottom: " + div.style.bottom + "; left: " + div.style.left + "; \n            max-width: " + div.style.maxWidth + "; width: " + div.style.width + "; text-align: center; position: " + div.style.position + ";";
      }

      this.parent.dotNetRef.invokeMethodAsync("ShowValidationPopup", toolTipPos);
    };

    return Edit;
  }();
  /**
   * InterSectionObserver - class watch whether it enters the viewport.
   * @hidden
   */


  var InterSectionObserver =
  /** @class */
  function () {
    function InterSectionObserver(element, options) {
      var _this = this;

      this.fromWheel = false;
      this.touchMove = false;
      /** @hidden */

      this.options = {};
      this.sentinelInfo = {
        'up': {
          check: function check(rect, info) {
            var top = rect.top - _this.containerRect.top;
            info.entered = top >= 0;
            return top + _this.options.pageHeight / 2 >= 0;
          },
          axis: 'Y'
        },
        'down': {
          check: function check(rect, info) {
            var cHeight = _this.options.container.clientHeight;
            var top = rect.bottom;
            info.entered = rect.bottom <= _this.containerRect.bottom;
            return top - _this.options.pageHeight / 2 <= _this.options.pageHeight / 2;
          },
          axis: 'Y'
        },
        'right': {
          check: function check(rect, info) {
            var right = rect.right;
            info.entered = right < _this.containerRect.right;
            return right - _this.containerRect.width <= _this.containerRect.right;
          },
          axis: 'X'
        },
        'left': {
          check: function check(rect, info) {
            var left = rect.left;
            info.entered = left > 0;
            return left + _this.containerRect.width >= _this.containerRect.left;
          },
          axis: 'X'
        }
      };
      this.element = element;
      this.options = options;
    }

    InterSectionObserver.prototype.observe = function (callback, onEnterCallback) {
      var _this = this;

      this.containerRect = this.options.container.getBoundingClientRect();
      sf.base.EventHandler.add(this.options.container, 'wheel', function () {
        return _this.fromWheel = true;
      }, this);
      sf.base.EventHandler.add(this.options.container, 'scroll', this.virtualScrollHandler(callback, onEnterCallback), this);
    };

    InterSectionObserver.prototype.check = function (direction) {
      var info = this.sentinelInfo[direction];
      return info.check(this.element.getBoundingClientRect(), info);
    };

    InterSectionObserver.prototype.virtualScrollHandler = function (callback, onEnterCallback) {
      var _this = this;

      var delay = sf.base.Browser.info.name === 'chrome' ? 200 : 100;
      var prevTop = 0;
      var prevLeft = 0;
      var debounced100 = sf.base.debounce(callback, delay);
      var debounced50 = sf.base.debounce(callback, 50);
      return function (e) {
        var top = e.target.scrollTop;
        var left = e.target.scrollLeft;
        var direction = prevTop < top ? 'down' : 'up';
        direction = prevLeft === left ? direction : prevLeft < left ? 'right' : 'left';
        prevTop = top;
        prevLeft = left;
        var current = _this.sentinelInfo[direction];

        if (_this.options.axes.indexOf(current.axis) === -1) {
          return;
        }

        var check = _this.check(direction);

        if (current.entered) {
          onEnterCallback(_this.element, current, direction, {
            top: top,
            left: left
          }, _this.fromWheel, check);
        }

        if (check) {
          var fn = debounced100; //this.fromWheel ? this.options.debounceEvent ? debounced100 : callback : debounced100;

          if (current.axis === 'X') {
            fn = debounced50;
          }

          fn({
            direction: direction,
            sentinel: current,
            offset: {
              top: top,
              left: left
            },
            focusElement: document.activeElement
          });
        }

        _this.fromWheel = false;
      };
    };

    InterSectionObserver.prototype.setPageHeight = function (value) {
      this.options.pageHeight = value;
    };

    return InterSectionObserver;
  }();
  /**
   * VirtualContentRenderer
   * @hidden
   */


  var VirtualContentRenderer =
  /** @class */
  function () {
    function VirtualContentRenderer(parent) {
      var _this = this;

      this.prevHeight = 0;
      this.preStartIndex = 0;
      this.preventEvent = false;
      this.actions = ['filtering', 'searching', 'grouping', 'ungrouping', 'Filtering', 'Searching', 'Grouping', 'Ungrouping'];
      this.offsets = {};
      this.tmpOffsets = {};
      this.offsetKeys = [];
      this.currentInfo = {};
      this.blazorActiveKey = '';
      this.nextRowToNavigate = 0;
      /** @hidden */

      this.virtualEle = new VirtualElementHandler();
      /** @hidden */

      this.startIndex = 0;

      this.bindScrollEvent = function () {
        _this.observer.observe(function (scrollArgs) {
          return _this.scrollListener(scrollArgs);
        }, _this.onEntered());

        var gObj = _this.parent;

        if (gObj.options.enablePersistence && gObj.scrollPosition) {
          _this.content.scrollTop = gObj.scrollPosition.top;
          var scrollValues = {
            direction: 'down',
            sentinel: _this.observer.sentinelInfo.down,
            offset: gObj.scrollPosition,
            focusElement: gObj.element
          };

          _this.scrollListener(scrollValues);

          if (gObj.options.enableColumnVirtualization) {
            _this.content.scrollLeft = gObj.scrollPosition.left;
          }
        }
      };

      this.parent = parent;
      this.contentPanel = this.parent.element.querySelector(".e-gridcontent");
      this.vHelper = new VirtualHelper(parent);
      this.addEventListener();
    }
    /**
     * Get the header content div element of grid
     * @return {Element}
     */


    VirtualContentRenderer.prototype.getPanel = function () {
      return this.contentPanel;
    };
    /**
     * Get the header table element of grid
     * @return {Element}
     */


    VirtualContentRenderer.prototype.getTable = function () {
      return this.contentPanel.querySelector('.e-table');
    };

    VirtualContentRenderer.prototype.renderTable = function () {
      this.header = this.parent.virtualHeaderModule;
      this.virtualEle.table = this.getTable();
      this.virtualEle.content = this.content = this.getPanel().querySelector('.e-content');
      this.virtualEle.renderWrapper(Number(this.parent.options.height));
      this.virtualEle.renderPlaceHolder();
      var content = this.content;
      var opt = {
        container: content,
        pageHeight: this.getBlockHeight() * 2,
        debounceEvent: true,
        axes: this.parent.options.enableColumnVirtualization ? ['X', 'Y'] : ['Y']
      };
      this.observer = new InterSectionObserver(this.virtualEle.wrapper, opt);
      this.parent.dotNetRef.invokeMethodAsync("SetRowHeight", this.parent.getRowHeight());
    };

    VirtualContentRenderer.prototype.addEventListener = function () {
      sf.base.EventHandler.add(this.parent.element, 'keydown', this.keyDownHandler, this);
    };

    VirtualContentRenderer.prototype.removeEventListener = function () {
      sf.base.EventHandler.remove(this.parent.element, 'keydown', this.keyDownHandler);
    };

    VirtualContentRenderer.prototype.ensurePageSize = function () {
      var rowHeight = this.parent.getRowHeight();
      var vHeight = this.parent.options.height.toString().indexOf('%') < 0 ? this.parent.options.height : this.parent.element.getBoundingClientRect().height;
      var blockSize = ~~(vHeight / rowHeight);
      var height = blockSize * 2;
      var size = this.parent.options.pageSize;
      var actualPageSize = size < height ? height : size;
      this.parent.dotNetRef.invokeMethodAsync("SetPageSizeAndCIndex", {
        pageSize: actualPageSize,
        startColumnIndex: this.startColIndex,
        endColumnIndex: this.endColIndex,
        VTableWidth: this.getColumnOffset(this.endColIndex) - this.getColumnOffset(this.startColIndex - 1) + ''
      });
      this.parent.options.pageSize = actualPageSize;
      this.observer.options.pageHeight = this.getBlockHeight() * 2;
    };

    VirtualContentRenderer.prototype.scrollListener = function (scrollArgs) {
      if (this.parent.options.enablePersistence) {
        this.parent.scrollPosition = scrollArgs.offset;
      }

      if (this.preventEvent) {
        this.preventEvent = false;
        return;
      } // if (this.preventEvent || this.parent.isDestroyed) { this.preventEvent = false; return; }


      var info = scrollArgs.sentinel;
      var pStartIndex = this.preStartIndex;
      var previousColIndexes = this.parent.getColumnIndexesInView();
      var viewInfo = this.currentInfo = this.getInfoFromView(scrollArgs.direction, info, scrollArgs.offset);

      if (this.parent.options.enableColumnVirtualization && JSON.stringify(previousColIndexes) !== JSON.stringify(viewInfo.columnIndexes)) {
        var translateX = this.getColumnOffset(this.startColIndex - 1);
        var width = this.getColumnOffset(this.endColIndex) - translateX + '';
        this.parent.dotNetRef.invokeMethodAsync("VirtualRefresh", {
          requestType: 'virtualscroll',
          startColumnIndex: viewInfo.columnIndexes[0],
          endColumnIndex: viewInfo.columnIndexes[viewInfo.columnIndexes.length - 1],
          axis: 'X',
          VTablewidth: width,
          translateX: this.getColumnOffset(viewInfo.columnIndexes[0] - 1)
        });
        this.setColVTableWidthAndTranslate();
      }

      this.parent.setColumnIndexesInView(this.parent.options.enableColumnVirtualization ? viewInfo.columnIndexes : []);
      this.nextRowToNavigate = this.blazorActiveKey != '' ? this.nextRowToNavigate : 0;

      if (this.preStartIndex !== pStartIndex) {
        this.parent.options.currentPage = viewInfo.currentPage;
        this.parent.dotNetRef.invokeMethodAsync("VirtualRefresh", {
          requestType: 'virtualscroll',
          nextRowToNavigate: this.nextRowToNavigate,
          virtualStartIndex: viewInfo.startIndex,
          virtualEndIndex: viewInfo.endIndex,
          axis: 'Y',
          RHeight: this.parent.getRowHeight()
        });
      }

      this.prevInfo = viewInfo;
      this.blazorActiveKey = '';
    };

    VirtualContentRenderer.prototype.setColVTableWidthAndTranslate = function (args) {
      if (this.parent.options.enableColumnVirtualization && this.prevInfo && JSON.stringify(this.currentInfo.columnIndexes) !== JSON.stringify(this.prevInfo.columnIndexes) || args && args.refresh) {
        var translateX = this.getColumnOffset(this.startColIndex - 1);
        var width = this.getColumnOffset(this.endColIndex) - translateX + '';
        this.header.virtualEle.setWrapperWidth(width);
        this.virtualEle.setWrapperWidth(width);
        this.header.virtualEle.adjustTable(translateX, 0);
        this.parent.getContentTable().parentElement.style.width = width + 'px';
      }
    };

    VirtualContentRenderer.prototype.refreshOnDataChange = function () {
      this.getPanel().firstElementChild.scrollTop = 0;
      this.getPanel().firstElementChild.scrollLeft = 0;

      if (this.parent.options.enableColumnVirtualization) {
        this.header.virtualEle.adjustTable(0, 0);
      }

      this.virtualEle.adjustTable(0, 0);
      this.refreshOffsets();
      this.refreshVirtualElement();
    }; // private block(blk: number): boolean {
    //     return this.vHelper.isBlockAvailable(blk);
    // }


    VirtualContentRenderer.prototype.keyDownHandler = function (e) {
      this.blazorActiveKey = e.key === 'ArrowDown' || e.key === 'ArrowUp' ? e.key : '';
    };

    VirtualContentRenderer.prototype.focusCell = function (cell, action) {
      cell.focus({
        preventScroll: true
      });
      var rowHeight = this.parent.getRowHeight();
      var content = this.parent.getContent();

      if (action == "MoveDownCell" && cell.getBoundingClientRect().bottom > content.getBoundingClientRect().top + content.getBoundingClientRect().height - getScrollBarWidth()) {
        content.scrollTop = content.scrollTop + rowHeight;
      } else if (action == "MoveUpCell" && cell.getBoundingClientRect().bottom < content.getBoundingClientRect().top + rowHeight) {
        this.isScrollFromFocus = true;
        content.scrollTop = content.scrollTop - rowHeight;
      }
    };

    VirtualContentRenderer.prototype.getInfoFromView = function (direction, info, e) {
      var infoType = {
        direction: direction,
        sentinelInfo: info,
        offsets: e,
        startIndex: this.preStartIndex,
        endIndex: this.preEndIndex
      };
      var vHeight = this.parent.options.height.toString().indexOf('%') < 0 ? this.content.getBoundingClientRect().height : this.parent.element.getBoundingClientRect().height;
      infoType.page = this.getPageFromTop(e.top + vHeight, infoType);
      infoType.blockIndexes = this.vHelper.getBlockIndexes(infoType.page); // infoType.blockIndexes = tempBlocks = this.vHelper.getBlockIndexes(infoType.page);
      // infoType.loadSelf = !this.vHelper.isBlockAvailable(tempBlocks[infoType.block]);
      // let blocks: number[] = this.ensureBlocks(infoType);
      // if (this.activeKey === 'upArrow' && infoType.blockIndexes.toString() !== blocks.toString()) {
      //     // To avoid dupilcate row index problem in key focus support
      //     let newBlock: number = blocks[blocks.length - 1];
      //     if (infoType.blockIndexes.indexOf(newBlock) === -1) {
      //         isBlockAdded = true;
      //     }
      // }
      // infoType.blockIndexes = blocks;
      // infoType.loadNext = !blocks.filter((val: number) => tempBlocks.indexOf(val) === -1)
      //     .every(this.block.bind(this));
      // infoType.event = (infoType.loadNext || infoType.loadSelf) ? 'modelChanged' : 'refreshVirtualBlock';
      // if (isBlockAdded) {
      //     infoType.blockIndexes = [infoType.blockIndexes[0] - 1, infoType.blockIndexes[0], infoType.blockIndexes[0] + 1];
      // }

      infoType.columnIndexes = info.axis === 'X' ? this.vHelper.getColumnIndexes() : this.parent.getColumnIndexesInView(); //Row Start and End Index calculation

      var rowHeight = this.parent.getRowHeight();
      var exactTopIndex = e.top / rowHeight;
      var noOfInViewIndexes = vHeight / rowHeight;
      var exactEndIndex = exactTopIndex + noOfInViewIndexes;
      var pageSizeBy4 = this.parent.options.pageSize / 4;
      var totalCount = this.parent.options.groupCount ? this.getVisibleGroupedRowCount() : this.count;

      if (infoType.direction === 'down' && !this.isScrollFromFocus) {
        var sIndex = Math.round(exactEndIndex) - Math.round(pageSizeBy4);

        if (sf.base.isNullOrUndefined(infoType.startIndex) || exactEndIndex > infoType.startIndex + Math.round(this.parent.options.pageSize / 2 + pageSizeBy4) && infoType.endIndex !== totalCount) {
          infoType.startIndex = sIndex >= 0 ? Math.round(sIndex) : 0;
          infoType.startIndex = infoType.startIndex > exactTopIndex ? Math.floor(exactTopIndex) : infoType.startIndex;
          var eIndex = infoType.startIndex + this.parent.options.pageSize;
          infoType.startIndex = eIndex < exactEndIndex ? Math.ceil(exactEndIndex) - this.parent.options.pageSize : infoType.startIndex;
          infoType.endIndex = eIndex < totalCount ? eIndex : totalCount;
          infoType.startIndex = eIndex >= totalCount ? infoType.endIndex - this.parent.options.pageSize : infoType.startIndex;
          infoType.currentPage = Math.ceil(infoType.endIndex / this.parent.options.pageSize);
          this.nextRowToNavigate = Math.floor(exactEndIndex - 1);
        }
      } else if (infoType.direction === 'up') {
        if (infoType.startIndex && infoType.endIndex) {
          var loadAtIndex = Math.round((infoType.startIndex * rowHeight + pageSizeBy4 * rowHeight) / rowHeight);

          if (exactTopIndex < loadAtIndex) {
            var idxAddedToExactTop = pageSizeBy4 > noOfInViewIndexes ? pageSizeBy4 : noOfInViewIndexes + noOfInViewIndexes / 4;
            var eIndex = Math.round(exactTopIndex + idxAddedToExactTop);
            infoType.endIndex = eIndex < totalCount ? eIndex : totalCount;
            var sIndex = infoType.endIndex - this.parent.options.pageSize;
            infoType.startIndex = sIndex > 0 ? sIndex : 0;
            infoType.endIndex = sIndex < 0 ? this.parent.options.pageSize : infoType.endIndex;
            infoType.currentPage = Math.ceil(infoType.startIndex / this.parent.options.pageSize);
            this.nextRowToNavigate = Math.ceil(exactTopIndex + 1);
          }
        }
      }

      this.isScrollFromFocus = false;
      this.preStartIndex = this.startIndex = infoType.startIndex;
      this.preEndIndex = infoType.endIndex;
      return infoType;
    };

    VirtualContentRenderer.prototype.onDataReady = function () {
      var _this = this;

      this.bindScrollEvent();
      this.count = this.parent.options.totalItemCount;
      this.maxPage = Math.ceil(this.count / this.parent.options.pageSize); // this.vHelper.checkAndResetCache(this.parent.options.requestType);

      if (['Refresh', 'Filtering', 'Searching', 'Grouping', 'Ungrouping', 'Reorder', 'refresh', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder', null].some(function (value) {
        return _this.parent.options.requestType === value;
      })) {
        this.refreshOffsets();
      }

      this.setVirtualHeight();
      this.resetScrollPosition(this.parent.options.requestType);
      this.setColVTableWidthAndTranslate();
      this.prevInfo = this.prevInfo ? this.prevInfo : this.vHelper.getData();
    };
    /** @hidden */


    VirtualContentRenderer.prototype.setVirtualHeight = function () {
      var width = this.parent.options.enableColumnVirtualization ? this.getColumnOffset(this.parent.options.columns.length + this.parent.options.groupCount - 1) + 'px' : '100%';
      var virtualHeight = this.parent.options.groupCount ? this.parent.options.visibleGroupedRowsCount * this.parent.getRowHeight() : this.offsets[this.getTotalBlocks()];
      this.virtualEle.setVirtualHeight(virtualHeight, width);

      if (this.parent.options.enableColumnVirtualization) {
        this.header.virtualEle.setVirtualHeight(1, width);
      }
    };

    VirtualContentRenderer.prototype.getPageFromTop = function (sTop, info) {
      var _this = this;

      var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();
      var page = 0;
      var extra = this.offsets[total] - this.prevHeight;
      this.offsetKeys.some(function (offset) {
        var iOffset = Number(offset);
        var border = sTop <= _this.offsets[offset] || iOffset === total && sTop > _this.offsets[offset];

        if (border) {
          info.block = iOffset % 2 === 0 ? 1 : 0;
          page = Math.max(1, Math.min(_this.vHelper.getPage(iOffset), _this.maxPage));
        }

        return border;
      });
      return page;
    };

    VirtualContentRenderer.prototype.getTranslateY = function (sTop, cHeight, info, isOnenter) {
      if (info === undefined) {
        info = {
          page: this.getPageFromTop(sTop + cHeight, {})
        };
        info.blockIndexes = this.vHelper.getBlockIndexes(info.page);
      }

      var block = (info.blockIndexes[0] || 1) - 1;
      var translate = this.getOffset(block);
      var endTranslate = this.getOffset(info.blockIndexes[info.blockIndexes.length - 1]);

      if (isOnenter) {
        info = this.prevInfo;
      }

      var result = translate > sTop ? this.getOffset(block - 1) : endTranslate < sTop + cHeight ? this.getOffset(block + 1) : translate;
      var blockHeight = this.offsets[info.blockIndexes[info.blockIndexes.length - 1]] - this.tmpOffsets[info.blockIndexes[0]];

      if (result + blockHeight > this.offsets[isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks()] && this.parent.options.groupCount == 0) {
        result -= result + blockHeight - this.offsets[this.getTotalBlocks()];
      }

      return result;
    };

    VirtualContentRenderer.prototype.getOffset = function (block) {
      return Math.min(this.offsets[block] | 0, this.offsets[this.maxBlock] | 0);
    };

    VirtualContentRenderer.prototype.onEntered = function () {
      var _this = this;

      return function (element, current, direction, e, isWheel, check) {
        if (sf.base.Browser.isIE && !isWheel && check && !_this.preventEvent) {//ToDo
          //this.parent.showSpinner();
        }

        var xAxis = current.axis === 'X';
        var top = _this.prevInfo.offsets ? _this.prevInfo.offsets.top : null;

        var height = _this.content.getBoundingClientRect().height;

        var x = _this.getColumnOffset(xAxis ? _this.vHelper.getColumnIndexes()[0] - 1 : _this.prevInfo.columnIndexes[0] - 1);

        var y = _this.getTranslateY(e.top, height, xAxis && top === e.top ? _this.prevInfo : undefined, true);

        if (_this.currentInfo && _this.currentInfo.startIndex && xAxis) {
          y = _this.currentInfo.startIndex * _this.parent.getRowHeight();
        }

        _this.virtualEle.adjustTable(x, Math.min(y, _this.offsets[_this.maxBlock]));

        if (xAxis) {
          _this.setColVTableWidthAndTranslate({
            refresh: true
          });
        }
      };
    };

    VirtualContentRenderer.prototype.getBlockSize = function () {
      return this.parent.options.pageSize >> 1;
    };

    VirtualContentRenderer.prototype.getBlockHeight = function () {
      return this.getBlockSize() * this.parent.getRowHeight();
    };

    VirtualContentRenderer.prototype.getGroupedTotalBlocks = function () {
      var visibleRowCount = this.getVisibleGroupedRowCount();
      return Math.floor(visibleRowCount / this.getBlockSize() < 1 ? 1 : visibleRowCount / this.getBlockSize());
    };

    VirtualContentRenderer.prototype.getVisibleGroupedRowCount = function () {
      var visibleRowCount = Number(this.virtualEle.placeholder.style.height.substring(0, this.virtualEle.placeholder.style.height.indexOf('p'))) / this.parent.getRowHeight();
      return visibleRowCount;
    };

    VirtualContentRenderer.prototype.getTotalBlocks = function () {
      return Math.ceil(this.count / this.getBlockSize());
    };

    VirtualContentRenderer.prototype.getColumnOffset = function (block) {
      return this.vHelper.cOffsets[block] | 0;
    };

    VirtualContentRenderer.prototype.resetScrollPosition = function (action) {
      if (this.actions.some(function (value) {
        return value === action;
      })) {
        var content = this.content;
        this.preventEvent = content.scrollTop !== 0;
        content.scrollTop = 0;
      }
    };
    /** @hidden */


    VirtualContentRenderer.prototype.refreshOffsets = function () {
      var gObj = this.parent;
      var row = 0;
      var bSize = this.getBlockSize();
      var total = isGroupAdaptive(this.parent) ? this.getGroupedTotalBlocks() : this.getTotalBlocks();
      this.prevHeight = this.offsets[total];
      this.maxBlock = total % 2 === 0 ? total - 2 : total - 1;
      this.offsets = {};
      var vcRows = [];
      var cache = {}; //Row offset update

      var blocks = Array.apply(null, Array(total)).map(function () {
        return ++row;
      });

      for (var i = 0; i < blocks.length; i++) {
        var tmp = (cache[blocks[i]] || []).length;
        var rem = !isGroupAdaptive(this.parent) ? this.count % bSize : vcRows.length % bSize;
        var size = !isGroupAdaptive(this.parent) && blocks[i] in cache ? tmp * this.parent.getRowHeight() : rem && blocks[i] === total ? rem * this.parent.getRowHeight() : this.getBlockHeight(); // let size: number = this.parent.groupSettings.columns.length && block in this.vHelper.cache ?
        // tmp * getRowHeight() : this.getBlockHeight();

        this.offsets[blocks[i]] = (this.offsets[blocks[i] - 1] | 0) + size;
        this.tmpOffsets[blocks[i]] = this.offsets[blocks[i] - 1] | 0;
      }

      this.offsetKeys = Object.keys(this.offsets); //Column offset update

      if (this.parent.options.enableColumnVirtualization) {
        this.vHelper.refreshColOffsets();
      }
    };

    VirtualContentRenderer.prototype.refreshColumnIndexes = function () {
      this.vHelper.refreshColOffsets();
      var colIndexes = this.vHelper.getColumnIndexes();
      this.parent.setColumnIndexesInView(colIndexes);
      this.parent.dotNetRef.invokeMethodAsync("SetColumnIndexes", colIndexes[0], colIndexes[colIndexes.length - 1]);
    };

    VirtualContentRenderer.prototype.refreshVirtualElement = function () {
      this.vHelper.refreshColOffsets();
      this.setVirtualHeight();
    };

    return VirtualContentRenderer;
  }();
  /**
   * @hidden
   */


  var VirtualHeaderRenderer =
  /** @class */
  function () {
    function VirtualHeaderRenderer(parent) {
      this.virtualEle = new VirtualElementHandler();
      this.parent = parent;
      this.vHelper = new VirtualHelper(this.parent);
      this.headerPanel = this.parent.element.querySelector(".e-gridheader");
    }
    /**
     * Get the header content div element of grid
     * @return {Element}
     */


    VirtualHeaderRenderer.prototype.getPanel = function () {
      return this.headerPanel;
    };
    /**
     * Get the header table element of grid
     * @return {Element}
     */


    VirtualHeaderRenderer.prototype.getTable = function () {
      return this.headerPanel.querySelector('.e-table');
    };

    VirtualHeaderRenderer.prototype.renderTable = function () {
      this.vHelper.refreshColOffsets();
      this.parent.setColumnIndexesInView(this.vHelper.getColumnIndexes(this.getPanel().querySelector('.e-headercontent')));
      this.virtualEle.table = this.getTable();
      this.virtualEle.content = this.getPanel().querySelector('.e-headercontent');
      this.virtualEle.content.style.position = 'relative';
      this.virtualEle.renderWrapper();
      this.virtualEle.renderPlaceHolder();
    };

    return VirtualHeaderRenderer;
  }();
  /**
   * @hidden
   */


  var VirtualElementHandler =
  /** @class */
  function () {
    function VirtualElementHandler() {}

    VirtualElementHandler.prototype.renderWrapper = function (height) {
      this.wrapper = this.content.querySelector('.e-virtualtable');
      this.wrapper.setAttribute('styles', "min-height:" + sf.base.formatUnit(height));
    };

    VirtualElementHandler.prototype.renderPlaceHolder = function () {
      this.placeholder = this.content.querySelector('.e-virtualtrack');
    };

    VirtualElementHandler.prototype.adjustTable = function (xValue, yValue) {
      this.wrapper.style.transform = "translate(" + xValue + "px, " + yValue + "px)";
    };

    VirtualElementHandler.prototype.setWrapperWidth = function (width, full) {
      this.wrapper.style.width = width ? width + "px" : full ? '100%' : '';
    };

    VirtualElementHandler.prototype.setVirtualHeight = function (height, width) {
      this.placeholder.style.height = height + "px";
      this.placeholder.style.width = width;
    };

    return VirtualElementHandler;
  }();
  /**
   * Content module is used to render grid content
   */


  var VirtualHelper =
  /** @class */
  function () {
    function VirtualHelper(parent) {
      this.cOffsets = {};
      this.data = {};
      this.groups = {};
      this.parent = parent;
    }

    VirtualHelper.prototype.getBlockIndexes = function (page) {
      return [page + (page - 1), page * 2];
    };

    VirtualHelper.prototype.getPage = function (block) {
      return block % 2 === 0 ? block / 2 : (block + 1) / 2;
    }; // public isBlockAvailable(value: number): boolean {
    //     // return value in this.cache;
    // }


    VirtualHelper.prototype.getData = function () {
      return {
        page: this.parent.options.currentPage,
        blockIndexes: this.getBlockIndexes(this.parent.options.currentPage),
        direction: 'down',
        columnIndexes: this.parent.getColumnIndexesInView()
      };
    }; // private getStartIndex(blk: number, data: Object[], full: boolean = true): number {
    //     let page: number = this.getPage(blk); let even: boolean = blk % 2 === 0;
    //     let index: number = (page - 1) * this.model.pageSize;
    //     return full || !even ? index : index + ~~(this.model.pageSize / 2);
    // }


    VirtualHelper.prototype.getColumnIndexes = function (content) {
      var _this = this;

      if (content === void 0) {
        content = this.parent.getHeaderContent();
      }

      var indexes = [];
      var sLeft = content.scrollLeft | 0;
      var keys = Object.keys(this.cOffsets);
      var cWidth = this.parent.options.needClientAction ? content.getBoundingClientRect().width : Number(this.parent.options.width);
      sLeft = Math.min(this.cOffsets[keys.length - 1] - cWidth, sLeft);
      var calWidth = sf.base.Browser.isDevice ? 2 * cWidth : cWidth / 2;
      var left = sLeft + cWidth + (sLeft === 0 ? calWidth : 0);
      keys.some(function (offset, indx, input) {
        var iOffset = Number(offset);
        var offsetVal = _this.cOffsets[offset];
        var border = sLeft - calWidth <= offsetVal && left + calWidth >= offsetVal;

        if (border) {
          indexes.push(iOffset);
        }

        return left + calWidth < offsetVal;
      });
      this.parent.virtualContentModule.startColIndex = indexes[0];
      this.parent.virtualContentModule.endColIndex = indexes[indexes.length - 1];
      return indexes;
    }; // public checkAndResetCache(action: string): boolean {
    //     let clear: boolean = ['paging', 'refresh', 'sorting', 'filtering', 'searching', 'grouping', 'ungrouping', 'reorder',
    //                         'save', 'delete'].some((value: string) => action === value);
    //     if (clear) {
    //         this.cache = {}; this.data = {}; this.groups = {};
    //     }
    //     return clear;
    // }


    VirtualHelper.prototype.refreshColOffsets = function () {
      var col = 0;
      this.cOffsets = {};
      var gLen = this.parent.options.groupCount;
      var cols = this.parent.options.columns;
      var cLen = cols.length; // let isVisible: Function = (column: Column) => column.visible &&
      //     (!this.parent.options.showGroupedColumn ? this.parent.options.groupedColumns.indexOf(column.field) < 0 : column.visible);
      // let c: string[] = this.parent.options.groupedColumns || [];
      // for (let i: number = 0; i < c.length; i++) {
      //     this.cOffsets[i] = (this.cOffsets[i - 1] | 0) + 30;
      // }

      var blocks = Array.apply(null, Array(cLen)).map(function () {
        return col++;
      });

      for (var j = 0; j < blocks.length; j++) {
        blocks[j] = blocks[j] + gLen;
        this.cOffsets[blocks[j]] = (this.cOffsets[blocks[j] - 1] | 0) + (cols[j].visible ? parseInt(cols[j].width, 10) : 0);
      }
    };

    return VirtualHelper;
  }();
  /**
   * SfGrid client constructor
   */


  var SfGrid =
  /** @class */
  function () {
    function SfGrid(element, options, dotnetRef) {
      this.columnModel = [];
      this.inViewIndexes = [];
      this.isRendered = false;
      this.element = element;
      this.element.blazor__instance = this;
      this.dotNetRef = dotnetRef;
      this.options = options;
      this.header = this.element.querySelector('.e-headercontent');
      this.content = this.element.querySelector('.e-content');
      this.footer = this.element.querySelector('.e-summarycontent');
      this.initModules();
    }

    SfGrid.prototype.initModules = function () {
      this.scrollModule = new Scroll(this);
      this.freezeModule = new Freeze(this);
      this.headerDragDrop = new HeaderDragDrop(this);
      this.contentDragDrop = new ContentDragDrop(this);
      this.reorderModule = new Reorder(this);
      this.groupModule = new Group(this);
      this.resizeModule = new Resize(this);
      this.editModule = new Edit(this);
      this.columnMenuModule = new ColumnMenu(this);
      this.columnChooserModule = new ColumnChooser(this);
      this.virtualContentModule = new VirtualContentRenderer(this);
      this.virtualHeaderModule = new VirtualHeaderRenderer(this);
      this.keyModule = new sf.base.KeyboardEvents(this.element, {
        keyAction: this.keyActionHandler.bind(this),
        keyConfigs: gridKeyConfigs,
        eventName: 'keydown'
      });

      if (this.options.enableColumnVirtualization) {
        this.virtualHeaderModule.renderTable();
      }

      if (this.options.enableVirtualization) {
        this.virtualContentModule.renderTable();
      }

      if (this.options.allowResizing) {
        this.resizeModule.render();
      }

      if (!this.options.needClientAction) {
        this.contentReady();
      } else {
        this.clientActions();
      }

      this.wireEvents();
      this.isRendered = true;
    };

    SfGrid.prototype.getHeaderContent = function () {
      return this.header;
    };

    SfGrid.prototype.getHeaderTable = function () {
      return this.header.querySelector('.e-table');
    };

    SfGrid.prototype.getContent = function () {
      return this.content;
    };

    SfGrid.prototype.getContentTable = function () {
      return this.content.querySelector('.e-table');
    };

    SfGrid.prototype.getFooterContent = function () {
      return this.footer;
    };

    SfGrid.prototype.getColumns = function (isRefresh) {
      // let inview: number[] = this.inViewIndexes.map((v: number) => v - this.groupSettings.columns.length).filter((v: number) => v > -1);
      // let vLen: number = inview.length;
      // if (!this.enableColumnVirtualization || isNullOrUndefined(this.columnModel) || this.columnModel.length === 0 || isRefresh) {
      //     this.columnModel = [];
      //     this.updateColumnModel(this.columns as Column[]);
      // }
      // let columns: Column[] = vLen === 0 ? this.columnModel :
      //     this.columnModel.slice(inview[0], inview[vLen - 1] + 1);
      this.columnModel = [];
      this.updateColumnModel(this.options.columns);
      return this.columnModel;
    };

    SfGrid.prototype.updateColumnModel = function (columns) {
      for (var i = 0, len = columns.length; i < len; i++) {
        if (columns[i].columns) {
          this.updateColumnModel(columns[i].columns);
        } else {
          this.columnModel.push(columns[i]);
        }
      } // this.updateFrozenColumns();
      // this.updateLockableColumns();

    };

    SfGrid.prototype.getColumnByIndex = function (index) {
      var column;
      this.getColumns().some(function (col, i) {
        column = col;
        return i === index;
      });
      return column;
    };
    /**
     * Gets a Column by column name.
     * @param  {string} field - Specifies the column name.
     * @return {Column}
     * @blazorType GridColumn
     */


    SfGrid.prototype.getColumnByField = function (field) {
      return iterateArrayOrObject(this.getColumns(), function (item, index) {
        if (item.field === field) {
          return item;
        }

        return undefined;
      })[0];
    };
    /**
     * Gets a column index by column name.
     * @param  {string} field - Specifies the column name.
     * @return {number}
     */


    SfGrid.prototype.getColumnIndexByField = function (field) {
      var cols = this.getColumns();

      for (var i = 0; i < cols.length; i++) {
        if (cols[i].field === field) {
          return i;
        }
      }

      return -1;
    };
    /**
     * Gets a column by UID.
     * @param  {string} uid - Specifies the column UID.
     * @return {Column}
     * @blazorType GridColumn
     */


    SfGrid.prototype.getColumnByUid = function (uid) {
      return iterateArrayOrObject(this.getColumns().concat(this.getStackedColumns(this.options.columns)), function (item, index) {
        if (item.uid === uid) {
          return item;
        }

        return undefined;
      })[0];
    };
    /**
     * @hidden
     */


    SfGrid.prototype.getStackedColumns = function (columns, stackedColumn) {
      if (stackedColumn === void 0) {
        stackedColumn = [];
      }

      for (var _i = 0, columns_1 = columns; _i < columns_1.length; _i++) {
        var column = columns_1[_i];

        if (column.columns) {
          stackedColumn.push(column);
          this.getStackedColumns(column.columns, stackedColumn);
        }
      }

      return stackedColumn;
    };
    /**
     * Gets a column index by UID.
     * @param  {string} uid - Specifies the column UID.
     * @return {number}
     */


    SfGrid.prototype.getColumnIndexByUid = function (uid) {
      var index = iterateArrayOrObject(this.getColumns(), function (item, index) {
        if (item.uid === uid) {
          return index;
        }

        return undefined;
      })[0];
      return !sf.base.isNullOrUndefined(index) ? index : -1;
    };
    /**
     * Gets a column header by UID.
     * @param  {string} field - Specifies the column uid.
     * @return {Element}
     */


    SfGrid.prototype.getColumnHeaderByUid = function (uid) {
      return this.getHeaderContent().querySelector('[e-mappinguid=' + uid + ']').parentElement;
    };
    /**
     * Gets UID by column name.
     * @param  {string} field - Specifies the column name.
     * @return {string}
     */


    SfGrid.prototype.getUidByColumnField = function (field) {
      return iterateArrayOrObject(this.getColumns(), function (item, index) {
        if (item.field === field) {
          return item.uid;
        }

        return undefined;
      })[0];
    };

    SfGrid.prototype.getStackedHeaderColumnByHeaderText = function (stackedHeader, col) {
      for (var i = 0; i < col.length; i++) {
        var individualColumn = col[i];

        if (individualColumn.field === stackedHeader || individualColumn.headerText === stackedHeader) {
          this.stackedColumn = individualColumn;
          break;
        } else if (individualColumn.columns) {
          this.getStackedHeaderColumnByHeaderText(stackedHeader, individualColumn.columns);
        }
      }

      return this.stackedColumn;
    };
    /**
    * Gets TH index by column uid value.
    * @private
    * @param  {string} uid - Specifies the column uid.
    * @return {number}
    */


    SfGrid.prototype.getNormalizedColumnIndex = function (uid) {
      var index = this.getColumnIndexByUid(uid);
      return index + this.getIndentCount();
    };
    /**
    * Gets indent cell count.
    * @private
    * @return {number}
    */


    SfGrid.prototype.getIndentCount = function () {
      var index = 0;

      if (this.options.allowGrouping) {
        index += this.options.groupCount;
      }

      if (this.options.hasDetailTemplate) {
        index++;
      }

      if (this.options.allowRowDragAndDrop && this.options.hasDropTarget) {
        index++;
      }
      /**
       * TODO: index normalization based on the stacked header, grouping and detailTemplate
       * and frozen should be handled here
       */


      return index;
    };
    /**
     * Gets indent Cell Width
     * @hidden
     */


    SfGrid.prototype.recalcIndentWidth = function () {
      if (!this.isRendered || !this.getHeaderTable().querySelector('.e-emptycell')) {
        return;
      } // Handle Detail and DragDrop


      if (!this.options.groupCount || !this.getContentTable() || this.getHeaderTable().querySelector('.e-emptycell').getAttribute("indentRefreshed")) {
        return;
      }

      var indentWidth = this.getHeaderTable().querySelector('.e-emptycell').parentElement.offsetWidth;
      var perPixel = indentWidth / 30;

      if (perPixel >= 1) {
        indentWidth = 30 / perPixel;
      } // if (this.enableColumnVirtualization || this.isAutoGen) { indentWidth = 30; }
      // if (this.isDetail()) {
      //     applyWidth(i, indentWidth);
      //     i++;
      // }
      // if (this.isRowDragable()) {
      //     applyWidth(i, indentWidth);
      // }


      this.getHeaderTable().querySelector('.e-emptycell').setAttribute('indentRefreshed', 'true');
      this.dotNetRef.invokeMethodAsync('SetIndentWidth', indentWidth + 'px');
    };

    SfGrid.prototype.contentReady = function (action) {
      if (action === void 0) {
        action = null;
      }

      if (this.getColumns().some(function (x) {
        return x.autoFit;
      })) {
        this.resizeModule.autoFit();
      }

      if (this.options.frozenColumns) {
        this.freezeModule.refreshRowHeight();
      }

      if (this.options.enableVirtualization) {
        this.virtualContentModule.onDataReady();
      }

      this.recalcIndentWidth();

      if (action === 'Paging') {
        //restore focus on paging.
        if (!parentsUntil(document.activeElement, 'e-grid')) {
          this.element.focus();
        }
      }
    };

    SfGrid.prototype.wireEvents = function () {
      sf.base.EventHandler.add(this.element, 'mousedown', this.mouseDownHandler, this);
      sf.base.EventHandler.add(this.element, 'focus', this.gridFocus, this);
    };

    SfGrid.prototype.setOptions = function (newOptions, options) {
      var oldOptions = sf.base.extend(options, {});
      this.options = newOptions;

      if (!oldOptions.allowResizing && newOptions.allowResizing) {
        this.resizeModule.render();
      }

      if (!oldOptions.allowGrouping && newOptions.allowGrouping || !oldOptions.allowReordering && newOptions.allowReordering) {
        this.headerDragDrop.initializeHeaderDrag();
        this.headerDragDrop.initializeHeaderDrop();
        this.groupModule.initializeGHeaderDrag();
        this.groupModule.initializeGHeaderDrop();
      }

      if (!oldOptions.allowGrouping && newOptions.allowGrouping) {
        this.contentDragDrop.initializeContentDrop();
      }

      if (oldOptions.groupCount != newOptions.groupCount) {
        var cell = this.getHeaderTable().querySelector('.e-emptycell');

        if (!cell) {
          return;
        }

        cell.removeAttribute('indentRefreshed');
      }
    };

    SfGrid.prototype.mouseDownHandler = function (e) {
      var gridElement = parentsUntil(e.target, 'e-grid');

      if (gridElement && gridElement.id !== this.element.id) {
        return;
      }

      if (e.shiftKey || e.ctrlKey) {
        e.preventDefault(); //prevent user select on shift pressing during selection
      }

      if (sf.base.closest(e.target, ".e-groupdroparea") || sf.base.closest(e.target, ".e-gridpopup") || sf.base.closest(e.target, ".e-summarycell") || sf.base.closest(e.target, ".e-groupcaption") || sf.base.closest(e.target, ".e-filterbarcell")) {
        return;
      } else {
        var Target = null;
        var CellUid = null;

        if (parentsUntil(e.target, 'e-headercontent')) {
          Target = "Header";
          CellUid = parentsUntil(e.target, 'e-headercell') ? parentsUntil(e.target, 'e-headercell').getAttribute('data-uid') : null;
        } else if (parentsUntil(e.target, 'e-content')) {
          Target = "Content";
          CellUid = parentsUntil(e.target, 'e-rowcell') ? parentsUntil(e.target, 'e-rowcell').getAttribute('data-uid') : null;
        } else if (parentsUntil(e.target, 'e-pager')) {
          Target = "Pager";
        } else if (parentsUntil(e.target, 'e-editcell')) {
          Target = "Edit";
        }

        this.dotNetRef.invokeMethodAsync("MouseDownHandler", Target, CellUid);
      }
    };

    SfGrid.prototype.gridFocus = function (e) {
      if (this.element.classList.contains("e-editing")) {
        return;
      }

      this.dotNetRef.invokeMethodAsync("GridFocus", e);
    };

    SfGrid.prototype.keyActionHandler = function (e) {
      if (e.action === 'pageUp' || e.action === 'pageDown' || e.action === 'ctrlAltPageUp' || e.action === 'ctrlAltPageDown' || e.action === 'altPageUp' || e.action === 'altPageDown' || e.action === 'altDownArrow' || e.action === 'ctrlPlusP') {
        e.preventDefault();
      }
    };

    SfGrid.prototype.destroy = function () {
      sf.base.EventHandler.remove(this.element, 'mousedown', this.mouseDownHandler);
      sf.base.EventHandler.remove(this.element, 'focus', this.gridFocus);
      this.keyModule.destroy();
      this.virtualContentModule.removeEventListener();
    };
    /**
         * @private
         */


    SfGrid.prototype.getColumnIndexesInView = function () {
      return this.inViewIndexes;
    };
    /**
     * @private
     */


    SfGrid.prototype.setColumnIndexesInView = function (indexes) {
      this.inViewIndexes = indexes;
    };

    SfGrid.prototype.getRowHeight = function () {
      return this.options.rowHeight ? this.options.rowHeight : getRowHeight(this.element);
    };

    SfGrid.prototype.clientActions = function () {
      if (this.options.enableVirtualization) {
        this.virtualContentModule.ensurePageSize();
      }
    };

    SfGrid.prototype.print = function () {
      this.removeColGroup();
      var printWind = window.open('', 'print', 'height=' + window.outerHeight + ',width=' + window.outerWidth + ',tabbar=no');
      printWind.moveTo(0, 0);
      printWind.resizeTo(screen.availWidth, screen.availHeight);
      sf.base.print(this.element, printWind);
    };

    SfGrid.prototype.removeColGroup = function () {
      var depth = this.options.groupCount;
      var element = this.element;
      var id = '#' + this.element.id;

      if (!depth) {
        return;
      }

      var groupCaption = element.querySelectorAll(".e-groupcaption");
      var colSpan = groupCaption[depth - 1].getAttribute('colspan');

      for (var i = 0; i < groupCaption.length; i++) {
        groupCaption[i].setAttribute('colspan', colSpan);
      }

      var colGroups = element.querySelectorAll("colgroup" + id + "colGroup");
      var contentColGroups = element.querySelector('.e-content').querySelectorAll('colgroup');
      this.hideColGroup(colGroups, depth);
      this.hideColGroup(contentColGroups, depth);
    };

    SfGrid.prototype.hideColGroup = function (colGroups, depth) {
      for (var i = 0; i < colGroups.length; i++) {
        for (var j = 0; j < depth; j++) {
          colGroups[i].childNodes[j].style.display = 'none';
        }
      }
    };

    return SfGrid;
  }();

  var gridKeyConfigs = {
    pageUp: 'pageup',
    pageDown: 'pagedown',
    ctrlAltPageUp: 'ctrl+alt+pageup',
    ctrlAltPageDown: 'ctrl+alt+pagedown',
    altPageUp: 'alt+pageup',
    altPageDown: 'alt+pagedown',
    altDownArrow: 'alt+downarrow',
    altUpArrow: 'alt+uparrow',
    ctrlDownArrow: 'ctrl+downarrow',
    ctrlUpArrow: 'ctrl+uparrow',
    ctrlPlusA: 'ctrl+A',
    ctrlPlusP: 'ctrl+P',
    ctrlPlusC: 'ctrl+C',
    ctrlShiftPlusH: 'ctrl+shift+H'
  };
  /**
   * Blazor grid interop handler
   */
  // tslint:disable

  var Grid = {
    initialize: function initialize(element, options, dotnetRef) {
      sf.base.enableBlazorMode();
      new SfGrid(element, options, dotnetRef);
    },
    contentReady: function contentReady(element, options, action) {
      var instance = element.blazor__instance;
      instance.setOptions(options, instance.options);
      instance.options = options;
      instance.contentReady(action);
    },
    reorderColumns: function reorderColumns(element, fromFName, toFName) {
      element.blazor__instance.reorderModule.reorderColumns(fromFName, toFName);
    },
    reorderColumnByIndex: function reorderColumnByIndex(element, fromIndex, toIndex) {
      element.blazor__instance.reorderModule.reorderColumnByIndex(fromIndex, toIndex);
    },
    reorderColumnByTargetIndex: function reorderColumnByTargetIndex(element, fieldName, toIndex) {
      element.blazor__instance.reorderModule.reorderColumnByTargetIndex(fieldName, toIndex);
    },
    renderColumnChooser: function renderColumnChooser(element) {
      element.blazor__instance.columnChooserModule.renderColumnChooser();
    },
    renderColumnMenu: function renderColumnMenu(element, uid) {
      element.blazor__instance.columnMenuModule.renderColumnMenu(uid);
    },
    autoFitColumns: function autoFitColumns(element, fieldNames) {
      element.blazor__instance.resizeModule.autoFitColumns(fieldNames);
    },
    refreshColumnIndex: function refreshColumnIndex(element, columns) {
      var instance = element.blazor__instance;
      instance.options.columns = columns;
      instance.virtualContentModule.refreshColumnIndexes();
    },
    focus: function focus(element, rowuid, celluid, action) {
      var cell = element.querySelector("[data-uid=\"" + celluid + "\"]");
      var instance = element.blazor__instance;

      if (!instance.options.enableVirtualization) {
        cell.focus();
      } else {
        instance.virtualContentModule.focusCell(cell, action);
      }
    },
    refreshOnDataChange: function refreshOnDataChange(element) {
      element.blazor__instance.virtualContentModule.refreshOnDataChange();
    },
    focusChild: function focusChild(element, rowuid, celluid) {
      var query = 'button, [href], input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])';
      var child = [].slice.call(element.querySelector("[data-uid=\"" + celluid + "\"]").querySelectorAll(query));
      /* Select the first focusable child element
       * if no child found then select the cell itself.
       * if Grid is in editable state, check for editable control inside child.
       */

      child.length > 0 ? child[0].focus() : element.querySelector("[data-uid=\"" + celluid + "\"]").focus();
      return child.length ? true : false;
    },
    destroy: function destroy(element) {
      element.blazor__instance.destroy();
    },
    validation: function validation(element, results, isAdd) {
      element.blazor__instance.editModule.createTooltip(results, isAdd);
    },
    focusCell: function focusCell(element, field, isAdd) {
      if (isAdd && element.blazor__instance.options.frozenColumns) {
        element.querySelector('.e-frozencontent').style.height = element.querySelector('.e-movablecontent').getBoundingClientRect().height + 'px';
      }

      if (field = "" && false) {
        element.querySelector("input.e-boolcell").focus();
      } else {
        element.querySelector("#" + field).focus();
      }
    },
    setFrozenHeight: function setFrozenHeight(element) {
      element.querySelector('.e-frozencontent').style.height = element.querySelector('.e-movablecontent').offsetHeight - getScrollBarWidth() + 'px';
    },
    printGrid: function printGrid(element) {
      element.blazor__instance.print();
    }
  };
  return Grid;
}();

/***/ })

}]);